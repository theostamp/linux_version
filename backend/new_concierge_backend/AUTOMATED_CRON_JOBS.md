# 🤖 Αυτοματοποίηση Εργασιών με Cron Jobs

Αυτός ο οδηγός εξηγεί πώς να ρυθμίσετε cron jobs στο server σας για την αυτόματη εκτέλεση περιοδικών εργασιών συντήρησης, όπως ο καθαρισμός παλιών αρχείων.

---

## 📖 Τι είναι το Cron;

Το Cron είναι ένα εργαλείο σε συστήματα Unix/Linux που επιτρέπει την εκτέλεση εντολών ή scripts σε προκαθορισμένες χρονικές στιγμές. Είναι ιδανικό για εργασίες συντήρησης, δημιουργία αντιγράφων ασφαλείας, και άλλες αυτοματοποιημένες διαδικασίες.

---

## 🛠️ Ρύθμιση Cron Job για το `cleanup_documents`

Θα ρυθμίσουμε μια εργασία που θα εκτελείται κάθε Κυριακή στις 03:00 π.μ. και θα διαγράφει τα ολοκληρωμένα παραστατικά που είναι παλαιότερα από 90 ημέρες.

### **Βήμα 1: Σύνδεση με τον Server**

Συνδεθείτε στον server σας μέσω SSH:
```bash
ssh user@your_server_ip
```

### **Βήμα 2: Εύρεση του Ονόματος του Docker Container**

Για να εκτελέσουμε μια εντολή μέσα στο container, χρειαζόμαστε το όνομά του. Εκτελέστε:
```bash
docker ps
```
Αναζητήστε το container του backend. Συνήθως, το όνομά του τελειώνει σε `-backend-1`, π.χ., `linux_version-backend-1`.

### **Βήμα 3: Άνοιγμα του Crontab Editor**

Το `crontab` είναι το αρχείο που περιέχει τις προγραμματισμένες εργασίες για τον χρήστη σας. Ανοίξτε το για επεξεργασία:
```bash
crontab -e
```
Αν είναι η πρώτη φορά, μπορεί να σας ζητηθεί να επιλέξετε έναν editor (π.χ., nano, vim). Επιλέξτε αυτόν που γνωρίζετε καλύτερα (το `nano` είναι συνήθως πιο φιλικό για αρχάριους).

### **Βήμα 4: Προσθήκη της Γραμμής του Cron Job**

Προσθέστε την παρακάτω γραμμή στο τέλος του αρχείου. **Προσοχή:** Αντικαταστήστε το `linux_version-backend-1` με το σωστό όνομα του container σας από το Βήμα 2.

```cron
0 3 * * 0 /usr/bin/docker exec linux_version-backend-1 python /app/backend/manage.py cleanup_documents --days 90 >> /var/log/cron_cleanup_documents.log 2>&1
```

**Ανάλυση της εντολής:**

-   `0 3 * * 0`: **Το Χρονοδιάγραμμα**. Σημαίνει "στις 03:00 κάθε Κυριακή". Μπορείτε να δημιουργήσετε τα δικά σας χρονοδιαγράμματα στο crontab.guru.
-   `/usr/bin/docker exec linux_version-backend-1`: **Η Εκτέλεση στο Docker**. Εκτελεί την εντολή μέσα στο container που "τρέχει".
-   `python /app/backend/manage.py cleanup_documents --days 90`: **Η Εντολή Django**. Εκτελεί το management command `cleanup_documents`, διαγράφοντας αρχεία παλαιότερα των 90 ημερών.
-   `>> /var/log/cron_cleanup_documents.log 2>&1`: **Η Καταγραφή (Logging)**. Αποθηκεύει το αποτέλεσμα (επιτυχίες και σφάλματα) σε ένα αρχείο log για μελλοντικό έλεγχο.

### **Βήμα 5: Αποθήκευση και Έξοδος**

-   **Για `nano`**: Πατήστε `Ctrl+X`, μετά `Y` για επιβεβαίωση, και τέλος `Enter`.
-   **Για `vim`**: Πατήστε `Esc`, μετά πληκτρολογήστε `:wq` και πατήστε `Enter`.

Θα δείτε ένα μήνυμα όπως `crontab: installing new crontab`.

---

## 🔎 Επαλήθευση & Αντιμετώπιση Προβλημάτων

-   **Ελέγξτε αν η εργασία καταχωρήθηκε**:
    ```bash
    crontab -l
    ```

-   **Δικαιώματα Docker**: Βεβαιωθείτε ότι ο χρήστης που εκτελεί το cron job έχει δικαίωμα να εκτελεί εντολές `docker`. Αν όχι, ίσως χρειαστεί να τον προσθέσετε στο group `docker` (`sudo usermod -aG docker $USER`) και να κάνετε logout/login.

-   **Έλεγχος του Log File**: Μετά την προγραμματισμένη ώρα εκτέλεσης, ελέγξτε το αρχείο log για να δείτε το αποτέλεσμα:
    ```bash
    cat /var/log/cron_cleanup_documents.log
    ```
    Αν το αρχείο δεν υπάρχει ή είναι κενό, βεβαιωθείτε ότι ο χρήστης έχει δικαιώματα εγγραφής στο `/var/log` ή αλλάξτε τη διαδρομή του log σε έναν κατάλογο που σας ανήκει (π.χ., `/home/your_user/logs/cron.log`).
