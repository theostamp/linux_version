# ğŸ—ºï¸ Î‘ÏÏ‡Î¹Ï„ÎµÎºÏ„Î¿Î½Î¹ÎºÎ® Î¡Î¿Î®Ï‚ Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½: Î ÏÎ¿ÏƒÏ†Î¿ÏÎ­Ï‚ â†’ ÎˆÏÎ³Î± â†’ Î”Î±Ï€Î¬Î½ÎµÏ‚

## ğŸ“‹ Î•Ï€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ· Î£Ï…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚

Î¤Î¿ ÏƒÏÏƒÏ„Î·Î¼Î± Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚ Î­ÏÎ³Ï‰Î½ Ï„Î¿Ï… New Concierge Ï…Î»Î¿Ï€Î¿Î¹ÎµÎ¯ Î¼Î¹Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Î· ÏÎ¿Î® Î±Ï€ÏŒ Ï„Î·Î½ Ï…Ï€Î¿Î²Î¿Î»Î® Ï€ÏÎ¿ÏƒÏ†Î¿ÏÎ¬Ï‚ Î¼Î­Ï‡ÏÎ¹ Ï„Î·Î½ Ï„ÎµÎ»Î¹ÎºÎ® Î´Î±Ï€Î¬Î½Î·, Î¼Îµ ÎºÎµÎ½Ï„ÏÎ¹ÎºÏŒ Î¬Î¾Î¿Î½Î± Ï„Î· ÏƒÎµÎ»Î¯Î´Î± **Î ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒÏ‚ ÎˆÏÎ³Î¿Ï…** (`/maintenance/scheduled/new`).

### ğŸ¯ Î’Î±ÏƒÎ¹ÎºÎ¿Î¯ Î£Ï„ÏŒÏ‡Î¿Î¹
1. **Î•Î½Î¹Î±Î¯Î± Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·**: ÎŒÎ»Î± Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÏÎ­Î¿Ï…Î½ Î¼Î­ÏƒÏ‰ Ï„Î·Ï‚ ÎºÎµÎ½Ï„ÏÎ¹ÎºÎ®Ï‚ Ï†ÏŒÏÎ¼Î±Ï‚ Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î¿Ï
2. **Î‘Î¼Ï†Î¯Î´ÏÎ¿Î¼Î· Î£ÏÎ½Î´ÎµÏƒÎ·**: Î¤Î± Ï€ÎµÎ´Î¯Î± ÏƒÏ…Î³Ï‡ÏÎ¿Î½Î¯Î¶Î¿Î½Ï„Î±Î¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Î¼ÎµÏ„Î±Î¾Ï Ï„Ï‰Î½ Î¿Î½Ï„Î¿Ï„Î®Ï„Ï‰Î½
3. **Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î”Î±Ï€Î±Î½ÏÎ½**: Î‘Ï€ÏŒ ÎµÎ³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î± Î­ÏÎ³Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ½Ï„Î±Î¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Î´Î±Ï€Î¬Î½ÎµÏ‚
4. **Î”Î¹Î±Ï†Î¬Î½ÎµÎ¹Î± ÎšÏŒÏƒÏ„Î¿Ï…Ï‚**: Î Î»Î®ÏÎ·Ï‚ Î±Î½Î¬Î»Ï…ÏƒÎ· Ï€Î»Î·ÏÏ‰Î¼ÏÎ½ ÎºÎ±Î¹ Î´ÏŒÏƒÎµÏ‰Î½

## âš ï¸ ÎšÎ¡Î™Î£Î™ÎœÎŸ Î Î¡ÎŸÎ’Î›Î—ÎœÎ‘ & Î›Î¥Î£Î— (Î•Ï€Î±Î»Î·Î¸ÎµÏ…Î¼Î­Î½Î¿ Î£ÎµÏ€ 2025)

### ğŸ”´ Î¤Î¿ Î ÏÏŒÎ²Î»Î·Î¼Î±
**Î— ÏƒÏÎ½Î´ÎµÏƒÎ· Î”Î•Î Î³Î¯Î½ÎµÏ„Î±Î¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î±!** ÎŒÏ„Î±Î½ ÎµÎ³ÎºÏÎ¯Î½ÎµÏ„Î±Î¹ Î¼Î¹Î± Ï€ÏÎ¿ÏƒÏ†Î¿ÏÎ¬ Î±Ï€ÏŒ Ï„Î¿ UI:
- âŒ Î”Î•Î Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯Ï„Î±Î¹ ScheduledMaintenance
- âŒ Î”Î•Î ÏƒÏ…Î³Ï‡ÏÎ¿Î½Î¯Î¶Î¿Î½Ï„Î±Î¹ Ï„Î± Ï€ÎµÎ´Î¯Î± Ï€Î»Î·ÏÏ‰Î¼Î®Ï‚
- âŒ Î”Î•Î Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ½Ï„Î±Î¹ Î´Î±Ï€Î¬Î½ÎµÏ‚

### ğŸŸ¢ Î— Î›ÏÏƒÎ·
Î— ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· `update_project_schedule()` Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÏƒÏ„Î¿ backend Î±Î»Î»Î¬ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎºÎ±Î»ÎµÎ¯Ï„Î±Î¹ ÏƒÏ‰ÏƒÏ„Î¬:

**Backend (`/backend/projects/views.py`):**
```python
@action(detail=True, methods=['post'])
def approve(self, request, pk=None):
    offer = self.get_object()
    with transaction.atomic():
        # 1. Î•Î³ÎºÏÎ¯Î½ÎµÎ¹ Ï„Î·Î½ Ï€ÏÎ¿ÏƒÏ†Î¿ÏÎ¬
        offer.status = 'accepted'
        offer.save()

        # 2. Î•Î½Î·Î¼ÎµÏÏÎ½ÎµÎ¹ Ï„Î¿ Î­ÏÎ³Î¿
        project = offer.project
        project.selected_contractor = offer.contractor_name
        project.final_cost = offer.amount
        project.payment_method = offer.payment_method
        project.installments = offer.installments
        project.advance_payment = offer.advance_payment
        project.status = 'approved'
        project.save()

        # 3. ÎšÎ¡Î™Î£Î™ÎœÎŸ: ÎšÎ±Î»ÎµÎ¯ Ï„Î·Î½ update_project_schedule
        update_project_schedule(project, offer)
```

**Frontend Î Î¡Î•Î Î•Î™ Î½Î± ÎºÎ±Î»ÎµÎ¯:**
```typescript
await makeRequestWithRetry({
  method: 'post',
  url: `/projects/offers/${offerId}/approve/`
});
```

### ğŸ“Š Î•Ï€Î±Î»Î·Î¸ÎµÏ…Î¼Î­Î½Î· Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± (Test Results)

**Input:**
- Î•Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· Ï€ÏÎ¿ÏƒÏ†Î¿ÏÎ¬: â‚¬6,500, 6 Î´ÏŒÏƒÎµÎ¹Ï‚, â‚¬2,000 Ï€ÏÎ¿ÎºÎ±Ï„Î±Î²Î¿Î»Î®

**Output Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ:**
```
âœ… ScheduledMaintenance ID: 1
   - Total Cost: â‚¬6,500.00
   - Contractor: Î±Î²Ï†Î³
   - Payment Method: installments
   - Installments: 6
   - Linked Project: eac13ada-4439-4759-acdb-5f29fa760069

âœ… 7 Expenses Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎ±Î½:
   - Î ÏÎ¿ÎºÎ±Ï„Î±Î²Î¿Î»Î® (31%): â‚¬2,000.00
   - Î”ÏŒÏƒÎ· 1/6: â‚¬750.00
   - Î”ÏŒÏƒÎ· 2/6: â‚¬750.00
   - Î”ÏŒÏƒÎ· 3/6: â‚¬750.00
   - Î”ÏŒÏƒÎ· 4/6: â‚¬750.00
   - Î”ÏŒÏƒÎ· 5/6: â‚¬750.00
   - Î”ÏŒÏƒÎ· 6/6: â‚¬750.00

âœ… Transactions Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎ±Î½ Î³Î¹Î± ÏŒÎ»Î± Ï„Î± Î´Î¹Î±Î¼ÎµÏÎ¯ÏƒÎ¼Î±Ï„Î±
```

---

## ğŸ—ï¸ Î”Î¿Î¼Î® Î’Î¬ÏƒÎ·Ï‚ Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½

### 1ï¸âƒ£ Projects (ÎˆÏÎ³Î±)
```python
# backend/projects/models.py
class Project:
    id = UUIDField (primary key)
    title = CharField
    description = TextField
    building = ForeignKey(Building)
    estimated_cost = DecimalField
    priority = CharField (low/medium/high/urgent)
    status = CharField (planning/tendering/evaluation/approved/in_progress/completed/cancelled)

    # Î ÎµÎ´Î¯Î± Î Î»Î·ÏÏ‰Î¼Î®Ï‚ (ÎµÏ…Î¸Ï…Î³ÏÎ±Î¼Î¼Î¹ÏƒÎ¼Î­Î½Î± Î¼Îµ ScheduledMaintenance)
    payment_terms = TextField
    payment_method = CharField
    installments = PositiveIntegerField
    advance_payment = DecimalField
    selected_contractor = CharField  # Î•Î½Î·Î¼ÎµÏÏÎ½ÎµÏ„Î±Î¹ Î±Ï€ÏŒ approved offer
    final_cost = DecimalField        # Î•Î½Î·Î¼ÎµÏÏÎ½ÎµÏ„Î±Î¹ Î±Ï€ÏŒ approved offer

    # Î£Ï…Î½Î´Î­ÏƒÎµÎ¹Ï‚
    linked_expense = ForeignKey(Expense)  # Î£ÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Î´Î±Ï€Î¬Î½Î·
```

### 2ï¸âƒ£ Offers (Î ÏÎ¿ÏƒÏ†Î¿ÏÎ­Ï‚)
```python
# backend/projects/models.py
class Offer:
    id = UUIDField (primary key)
    project = ForeignKey(Project)
    contractor_name = CharField
    contractor_contact = CharField
    contractor_phone = CharField
    contractor_email = EmailField
    amount = DecimalField

    # Î ÎµÎ´Î¯Î± Î Î»Î·ÏÏ‰Î¼Î®Ï‚ (Î¯Î´Î¹Î± Î¼Îµ Project)
    payment_terms = TextField
    payment_method = CharField
    installments = PositiveIntegerField
    advance_payment = DecimalField

    status = CharField (submitted/under_review/accepted/rejected/withdrawn)
```

### 3ï¸âƒ£ ScheduledMaintenance (Î ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î­Î½Î± ÎˆÏÎ³Î±)
```python
# backend/maintenance/models.py
class ScheduledMaintenance:
    id = AutoField (primary key)
    title = CharField
    description = TextField
    building = ForeignKey(Building)
    contractor = ForeignKey(Contractor)
    scheduled_date = DateField
    priority = CharField
    status = CharField

    # Î•Î½Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î± Î ÎµÎ´Î¯Î± ÎšÏŒÏƒÏ„Î¿Ï…Ï‚
    estimated_cost = DecimalField
    actual_cost = DecimalField
    total_cost = DecimalField  # ÎšÏÏÎ¹Î¿ Ï€ÎµÎ´Î¯Î¿ Î³Î¹Î± UI

    # Î ÎµÎ´Î¯Î± Î Î»Î·ÏÏ‰Î¼Î®Ï‚ (Î±Ï€ÏŒ ÎµÎ³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ Ï€ÏÎ¿ÏƒÏ†Î¿ÏÎ­Ï‚)
    payment_method = CharField
    installments = PositiveIntegerField
    advance_payment = DecimalField
    payment_terms = TextField

    # Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± Î£Ï…Î½ÎµÏÎ³ÎµÎ¯Î¿Ï… (Î±Ï€ÎµÏ…Î¸ÎµÎ¯Î±Ï‚ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·)
    contractor_name = CharField
    contractor_contact = CharField
    contractor_phone = CharField
    contractor_email = EmailField

    # Î£Ï…Î½Î´Î­ÏƒÎµÎ¹Ï‚
    linked_project = ForeignKey(Project)  # Î‘Ï€ÏŒ ÎµÎ³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· Ï€ÏÎ¿ÏƒÏ†Î¿ÏÎ¬
    linked_expense = ForeignKey(Expense)  # Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¼Î­Î½Î· Î´Î±Ï€Î¬Î½Î·
```

### 4ï¸âƒ£ Expense (Î”Î±Ï€Î¬Î½ÎµÏ‚)
```python
# backend/financial/models.py
class Expense:
    id = AutoField (primary key)
    building = ForeignKey(Building)
    title = CharField
    amount = DecimalField
    date = DateField
    category = CharField
    distribution_type = CharField

    # Î£Ï…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î± Î­ÏÎ³Î±
    scheduled_maintenance_tasks = reverse FK Î±Ï€ÏŒ ScheduledMaintenance
    linked_projects = reverse FK Î±Ï€ÏŒ Project
```

### 5ï¸âƒ£ PaymentSchedule (Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î Î»Î·ÏÏ‰Î¼ÏÎ½)
```python
# backend/maintenance/models.py
class PaymentSchedule:
    scheduled_maintenance = OneToOneField(ScheduledMaintenance)
    payment_type = CharField (lump_sum/advance_installments/periodic/milestone_based)
    total_amount = DecimalField
    advance_percentage = IntegerField
    installment_count = IntegerField
    installment_frequency = CharField
    start_date = DateField
```

---

## ğŸ”„ Î¡Î¿Î® Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ (Î•Ï€Î±Î»Î·Î¸ÎµÏ…Î¼Î­Î½Î·)

### Î’Î®Î¼Î± 1: Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎˆÏÎ³Î¿Ï… & Î£Ï…Î»Î»Î¿Î³Î® Î ÏÎ¿ÏƒÏ†Î¿ÏÏÎ½
```
[Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎˆÏÎ³Î¿Ï…] â†’ [Project]
                          â†“
                   [Tender Deadline]
                          â†“
              [Î£Ï…Î»Î»Î¿Î³Î® Î ÏÎ¿ÏƒÏ†Î¿ÏÏÎ½] â†’ [Offers]
```

### Î’Î®Î¼Î± 2: ÎˆÎ³ÎºÏÎ¹ÏƒÎ· Î ÏÎ¿ÏƒÏ†Î¿ÏÎ¬Ï‚ (ÎšÎ¡Î™Î£Î™ÎœÎŸ)
```
[Frontend: Button "ÎˆÎ³ÎºÏÎ¹ÏƒÎ·"]
            â†“
[POST /projects/offers/{id}/approve/]
            â†“
[Backend: approve() action]
            â†“
[Offer Status: accepted]
            â†“
[Update Project Î¼Îµ fields Î±Ï€ÏŒ Offer]
            â†“
[ÎšÎ‘Î›Î•Î™ update_project_schedule(project, offer)]
            â†“
[Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ ScheduledMaintenance + Expenses]
```

### Î’Î®Î¼Î± 3: Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î±Ï€ÏŒ update_project_schedule()
```python
def update_project_schedule(project, offer=None):
    # 1. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯/Î•Î½Î·Î¼ÎµÏÏÎ½ÎµÎ¹ ScheduledMaintenance
    scheduled_maintenance = ScheduledMaintenance.objects.get_or_create(
        linked_project=project,
        defaults={
            'title': project.title,
            'total_cost': project.final_cost,
            'contractor_name': offer.contractor_name,
            'contractor_phone': offer.contractor_phone,
            'contractor_email': offer.contractor_email,
            'payment_method': offer.payment_method,
            'installments': offer.installments,
            'advance_payment': offer.advance_payment
        }
    )

    # 2. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Expenses Î³Î¹Î± Î´ÏŒÏƒÎµÎ¹Ï‚
    if installments > 1:
        # Î ÏÎ¿ÎºÎ±Ï„Î±Î²Î¿Î»Î®
        create_expense(
            title=f"{project.title} - Î ÏÎ¿ÎºÎ±Ï„Î±Î²Î¿Î»Î®",
            amount=advance_payment
        )

        # Î”ÏŒÏƒÎµÎ¹Ï‚
        for i in range(1, installments + 1):
            create_expense(
                title=f"{project.title} - Î”ÏŒÏƒÎ· {i}/{installments}",
                amount=installment_amount
            )
```

### Î’Î®Î¼Î± 4: Î§ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î· Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î”Î±Ï€Î±Î½ÏÎ½ (Î•Î½Î±Î»Î»Î±ÎºÏ„Î¹ÎºÎ¬)
```
[ScheduledMaintenance Status: completed] â†’ [Receipt Modal]
                                                  â†“
                                           [Create Expense]
                                                  â†“
                                           [ServiceReceipt]
```

---

## ğŸ’» Frontend Components

### ğŸ“„ ProjectOffersTab (`/frontend/app/(dashboard)/projects/[id]/page.tsx`)

**ÎšÎ¡Î™Î£Î™ÎœÎŸ: Î£Ï‰ÏƒÏ„Î® ÎºÎ»Î®ÏƒÎ· Ï„Î¿Ï… approve endpoint:**
```typescript
// Î“ÏÎ±Î¼Î¼Î® 254-268
onConfirm={async () => {
  if (!confirm.id) return;
  try {
    setIsApproving(true);
    // Î£Î©Î£Î¤ÎŸ ENDPOINT
    await makeRequestWithRetry({
      method: 'post',
      url: `/projects/offers/${confirm.id}/approve/`,  // â† ÎšÎ¡Î™Î£Î™ÎœÎŸ
      xToastSuppress: true
    });
    toast({ title: 'Î•Ï€Î¹Ï„Ï…Ï‡Î¯Î±', description: 'Î— Ï€ÏÎ¿ÏƒÏ†Î¿ÏÎ¬ ÎµÎ³ÎºÏÎ¯Î¸Î·ÎºÎµ.' });
    setRefresh((n) => n + 1);
    onApproved && onApproved();
  } catch (e: any) {
    toast({ title: 'Î£Ï†Î¬Î»Î¼Î±', description: e?.message ?? 'Î‘Ï€Î¿Ï„Ï…Ï‡Î¯Î± Î­Î³ÎºÏÎ¹ÏƒÎ·Ï‚' });
  }
}}
```

### ğŸ“„ ScheduledMaintenanceForm (`/frontend/components/maintenance/ScheduledMaintenanceForm.tsx`)

**Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î±:**
- ÎšÎµÎ½Ï„ÏÎ¹ÎºÎ® Ï†ÏŒÏÎ¼Î± Î³Î¹Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±/ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î­Î½Ï‰Î½ Î­ÏÎ³Ï‰Î½
- Auto-populate Î±Ï€ÏŒ ÎµÎ³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ Ï€ÏÎ¿ÏƒÏ†Î¿ÏÎ­Ï‚ (Î³ÏÎ±Î¼Î¼Î­Ï‚ 156-181)
- Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï€Î»Î·ÏÏ‰Î¼ÏÎ½ Î¼Î­ÏƒÏ‰ `PaymentConfigurationSection`
- Modal Î³Î¹Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î±Ï€ÏŒÎ´ÎµÎ¹Î¾Î·Ï‚/Î´Î±Ï€Î¬Î½Î·Ï‚ (Î³ÏÎ±Î¼Î¼Î­Ï‚ 916-1039)

---

## ğŸ”§ Backend API Endpoints

### Projects API
```python
# /api/projects/projects/
GET    - Î›Î¯ÏƒÏ„Î± Î­ÏÎ³Ï‰Î½
POST   - Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î­ÏÎ³Î¿Ï…
GET    /{id}/ - Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ Î­ÏÎ³Î¿Ï… Î¼Îµ offers
PATCH  /{id}/ - Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î­ÏÎ³Î¿Ï…
DELETE /{id}/ - Î”Î¹Î±Î³ÏÎ±Ï†Î® Î­ÏÎ³Î¿Ï…
```

### Offers API (ÎšÎ¡Î™Î£Î™ÎœÎŸ)
```python
# /api/projects/offers/
GET    - Î›Î¯ÏƒÏ„Î± Ï€ÏÎ¿ÏƒÏ†Î¿ÏÏÎ½
POST   - Î¥Ï€Î¿Î²Î¿Î»Î® Ï€ÏÎ¿ÏƒÏ†Î¿ÏÎ¬Ï‚
GET    /{id}/ - Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ Ï€ÏÎ¿ÏƒÏ†Î¿ÏÎ¬Ï‚
PATCH  /{id}/ - Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï€ÏÎ¿ÏƒÏ†Î¿ÏÎ¬Ï‚

# ÎšÎ¡Î™Î£Î™ÎœÎŸ ENDPOINT
POST   /{id}/approve/ - ÎˆÎ³ÎºÏÎ¹ÏƒÎ· Ï€ÏÎ¿ÏƒÏ†Î¿ÏÎ¬Ï‚ & Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ScheduledMaintenance
POST   /{id}/reject/  - Î‘Ï€ÏŒÏÏÎ¹ÏˆÎ· Ï€ÏÎ¿ÏƒÏ†Î¿ÏÎ¬Ï‚
```

### ScheduledMaintenance API
```python
# /api/maintenance/scheduled/
GET    - Î›Î¯ÏƒÏ„Î± Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î­Î½Ï‰Î½ Î­ÏÎ³Ï‰Î½
POST   - Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î­ÏÎ³Î¿Ï…
GET    /{id}/ - Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ Î­ÏÎ³Î¿Ï…
PATCH  /{id}/ - Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î­ÏÎ³Î¿Ï…
DELETE /{id}/ - Î”Î¹Î±Î³ÏÎ±Ï†Î® Î­ÏÎ³Î¿Ï…

# Custom endpoints
POST   /{id}/create_payment_schedule/ - Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï€ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î¿Ï‚ Ï€Î»Î·ÏÏ‰Î¼ÏÎ½
```

---

## ğŸš€ ÎŸÎ´Î·Î³Î¯ÎµÏ‚ Î¥Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚

### 1. ÎˆÎ³ÎºÏÎ¹ÏƒÎ· Î ÏÎ¿ÏƒÏ†Î¿ÏÎ¬Ï‚ (Î£Ï‰ÏƒÏ„Î® Î”Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î±)

**Frontend:**
```typescript
// Î£Î©Î£Î¤ÎŸ - ÎšÎ±Î»ÎµÎ¯ Ï„Î¿ approve endpoint
await api.post(`/projects/offers/${offerId}/approve/`);

// Î›Î‘Î˜ÎŸÎ£ - Î‘Ï€Î»Î® ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· status
await api.patch(`/projects/offers/${offerId}/`, { status: 'accepted' });
```

**Backend (Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î· ÎµÎºÏ„Î­Î»ÎµÏƒÎ·):**
```python
# Î£Ï„Î¿ OfferViewSet.approve():
1. offer.status = 'accepted'
2. project.selected_contractor = offer.contractor_name
3. project.final_cost = offer.amount
4. project.payment_method = offer.payment_method
5. project.installments = offer.installments
6. project.advance_payment = offer.advance_payment
7. project.status = 'approved'
8. update_project_schedule(project, offer)  # ÎšÎ¡Î™Î£Î™ÎœÎŸ!
```

### 2. Î§ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î· Î”Î¹ÏŒÏÎ¸Ï‰ÏƒÎ· (Î±Î½ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹)

**Python Script:**
```python
from projects.views import update_project_schedule
from projects.models import Project, Offer

# Î’ÏÎµÏ‚ ÎµÎ³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· Ï€ÏÎ¿ÏƒÏ†Î¿ÏÎ¬ Ï€Î¿Ï… Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ ScheduledMaintenance
offer = Offer.objects.filter(status='accepted').first()
project = offer.project

# Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎµ Ï„Î¿ project
project.selected_contractor = offer.contractor_name
project.final_cost = offer.amount
project.payment_method = offer.payment_method
project.installments = offer.installments
project.advance_payment = offer.advance_payment
project.status = 'approved'
project.save()

# ÎšÎ¬Î»ÎµÏƒÎµ Ï„Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ·
update_project_schedule(project, offer)
```

---

## ğŸ› Î‘Î½Ï„Î¹Î¼ÎµÏ„ÏÏ€Î¹ÏƒÎ· Î ÏÎ¿Î²Î»Î·Î¼Î¬Ï„Ï‰Î½

### Î ÏÏŒÎ²Î»Î·Î¼Î± 1: Î”ÎµÎ½ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯Ï„Î±Î¹ ScheduledMaintenance
**Î‘Î¹Ï„Î¯Î±:** Î¤Î¿ frontend Î´ÎµÎ½ ÎºÎ±Î»ÎµÎ¯ Ï„Î¿ `/approve/` endpoint
**Î›ÏÏƒÎ·:** Î’ÎµÎ²Î±Î¹Ï‰Î¸ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Ï„Î¿ ÏƒÏ‰ÏƒÏ„ÏŒ endpoint

### Î ÏÏŒÎ²Î»Î·Î¼Î± 2: Î”Î¹Ï€Î»Î­Ï‚ Î”Î±Ï€Î¬Î½ÎµÏ‚
**Î‘Î¹Ï„Î¯Î±:** Î— `update_project_schedule()` ÎºÎ±Î»ÎµÎ¯Ï„Î±Î¹ Ï€Î¿Î»Î»Î­Ï‚ Ï†Î¿ÏÎ­Ï‚
**Î›ÏÏƒÎ·:** Î§ÏÎ®ÏƒÎ· `get_or_create` ÎºÎ±Î¹ Î­Î»ÎµÎ³Ï‡Î¿Ï‚ Î³Î¹Î± existing expenses

### Î ÏÏŒÎ²Î»Î·Î¼Î± 3: Î‘ÏƒÏ…Î³Ï‡ÏÏŒÎ½Î¹ÏƒÏ„Î± Î ÎµÎ´Î¯Î±
**Î‘Î¹Ï„Î¯Î±:** Î¤Î¿ Project Î´ÎµÎ½ ÎµÎ½Î·Î¼ÎµÏÏÎ½ÎµÏ„Î±Î¹ Î±Ï€ÏŒ Ï„Î·Î½ Offer
**Î›ÏÏƒÎ·:** Î’ÎµÎ²Î±Î¹Ï‰Î¸ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ ÏŒÎ»Î± Ï„Î± Ï€ÎµÎ´Î¯Î± Î±Î½Ï„Î¹Î³ÏÎ¬Ï†Î¿Î½Ï„Î±Î¹ ÏƒÏ„Î¿ approve()

---

## âœ… Checklist Î•Î»Î­Î³Ï‡Î¿Ï…

### ÎˆÎ³ÎºÏÎ¹ÏƒÎ· Î ÏÎ¿ÏƒÏ†Î¿ÏÎ¬Ï‚
- [ ] Frontend ÎºÎ±Î»ÎµÎ¯ `/projects/offers/{id}/approve/`
- [ ] Offer status Î³Î¯Î½ÎµÏ„Î±Î¹ 'accepted'
- [ ] Project ÎµÎ½Î·Î¼ÎµÏÏÎ½ÎµÏ„Î±Î¹ Î¼Îµ ÏŒÎ»Î± Ï„Î± Ï€ÎµÎ´Î¯Î± Î±Ï€ÏŒ Offer
- [ ] Project status Î³Î¯Î½ÎµÏ„Î±Î¹ 'approved'
- [ ] ÎšÎ±Î»ÎµÎ¯Ï„Î±Î¹ Î· `update_project_schedule()`

### Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ScheduledMaintenance
- [ ] Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯Ï„Î±Î¹ Î¼Îµ `linked_project` reference
- [ ] Î‘Î½Ï„Î¹Î³ÏÎ¬Ï†Î¿Î½Ï„Î±Î¹ ÏŒÎ»Î± Ï„Î± contractor fields
- [ ] Î‘Î½Ï„Î¹Î³ÏÎ¬Ï†Î¿Î½Ï„Î±Î¹ ÏŒÎ»Î± Ï„Î± payment fields
- [ ] `total_cost` = `offer.amount`

### Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î”Î±Ï€Î±Î½ÏÎ½
- [ ] Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯Ï„Î±Î¹ Ï€ÏÎ¿ÎºÎ±Ï„Î±Î²Î¿Î»Î® (Î±Î½ installments > 1)
- [ ] Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ½Ï„Î±Î¹ Î´ÏŒÏƒÎµÎ¹Ï‚ Î³Î¹Î± ÎºÎ¬Î¸Îµ Î¼Î®Î½Î±
- [ ] ÎšÎ¬Î¸Îµ expense Î­Ï‡ÎµÎ¹ ÏƒÏ‰ÏƒÏ„ÏŒ amount
- [ ] Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ½Ï„Î±Î¹ transactions Î³Î¹Î± Î´Î¹Î±Î¼ÎµÏÎ¯ÏƒÎ¼Î±Ï„Î±

---

## ğŸ“š Î£Ï‡ÎµÏ„Î¹ÎºÎ¬ Î‘ÏÏ‡ÎµÎ¯Î±

### Frontend
- `/frontend/app/(dashboard)/projects/[id]/page.tsx` - Project details Î¼Îµ Offers tab
- `/frontend/components/maintenance/ScheduledMaintenanceForm.tsx` - ÎšÎµÎ½Ï„ÏÎ¹ÎºÎ® Ï†ÏŒÏÎ¼Î±
- `/frontend/components/maintenance/PaymentConfigurationSection.tsx` - Î”Î¹Î±Î¼ÏŒÏÏ†Ï‰ÏƒÎ· Ï€Î»Î·ÏÏ‰Î¼ÏÎ½

### Backend
- `/backend/projects/views.py` - **ÎšÎ¡Î™Î£Î™ÎœÎŸ: approve() & update_project_schedule()**
- `/backend/maintenance/models.py` - Models Î³Î¹Î± ScheduledMaintenance
- `/backend/projects/models.py` - Models Î³Î¹Î± Project, Offer
- `/backend/financial/models.py` - Model Î³Î¹Î± Expense

### Test Scripts
- `/test_and_fix_offer_flow.py` - Script Î³Î¹Î± Î­Î»ÎµÎ³Ï‡Î¿ ÎºÎ±Î¹ Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ· Ï„Î·Ï‚ ÏÎ¿Î®Ï‚
- `/check_offer_project_connection.py` - Script Î³Î¹Î± Î­Î»ÎµÎ³Ï‡Î¿ ÏƒÏ…Î½Î´Î­ÏƒÎµÏ‰Î½

---

## ğŸ”„ ÎœÎµÎ»Î»Î¿Î½Ï„Î¹ÎºÎ­Ï‚ Î’ÎµÎ»Ï„Î¹ÏÏƒÎµÎ¹Ï‚

1. **Automated Trigger**: Signal Ï€Î¿Ï… ÎºÎ±Î»ÎµÎ¯ `update_project_schedule()` ÏŒÏ„Î±Î½ offer.status='accepted'
2. **UI Feedback**: Progress indicator ÎºÎ±Ï„Î¬ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± expenses
3. **Validation**: Pre-check Ï€ÏÎ¹Î½ Ï„Î·Î½ Î­Î³ÎºÏÎ¹ÏƒÎ· Î³Î¹Î± required fields
4. **Rollback**: ÎœÎ·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒÏ‚ Î±ÎºÏÏÏ‰ÏƒÎ·Ï‚ Î±Î½ Î±Ï€Î¿Ï„ÏÏ‡ÎµÎ¹ ÎºÎ¬Ï€Î¿Î¹Î¿ Î²Î®Î¼Î±
5. **Audit Trail**: Log Î³Î¹Î± ÎºÎ¬Î¸Îµ Î²Î®Î¼Î± Ï„Î·Ï‚ Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î±Ï‚

---

## ğŸ“ Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î± & Support

Î“Î¹Î± Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ Î±Ï€Î¿ÏÎ¯Î± Î® Ï€ÏÏŒÎ²Î»Î·Î¼Î± ÏƒÏ„Î·Î½ Ï…Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ·, Î±Î½Î±Ï„ÏÎ­Î¾Ï„Îµ ÏƒÏ„Î¿ CLAUDE.md Î® Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î± test scripts Î³Î¹Î± Î´Î¹Î¬Î³Î½Ï‰ÏƒÎ·.

---

## 7. Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ· Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±Ï‚ (22 Î£ÎµÏ€Ï„ÎµÎ¼Î²ÏÎ¯Î¿Ï… 2025)

### âœ… Î¤Î•Î›Î™ÎšÎ— Î•Î Î™Î¤Î¥Î§Î—Î£ Î•Î Î‘Î›Î—Î˜Î•Î¥Î£Î—

ÎœÎµÏ„Î¬ Ï„Î¹Ï‚ Î´Î¹Î¿ÏÎ¸ÏÏƒÎµÎ¹Ï‚, Î· ÏÎ¿Î® Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Î Î›Î—Î¡Î©Î£:

```
ğŸ¯ Î¤Î•Î›Î™ÎšÎ— Î•Î Î‘Î›Î—Î˜Î•Î¥Î£Î— Î¡ÎŸÎ—Î£: OFFER â†’ PROJECT â†’ SCHEDULED â†’ EXPENSES
======================================================================
1ï¸âƒ£ PROJECT:
   â€¢ Status: approved âœ…
   â€¢ Final Cost: 6500.00â‚¬ âœ…
   â€¢ Contractor: Î±Î²Ï†Î³ âœ…

2ï¸âƒ£ ACCEPTED OFFER:
   â€¢ Status: accepted âœ…
   â€¢ Amount: 6500.00â‚¬
   â€¢ Advance: 2000.00â‚¬
   â€¢ Installments: 6

3ï¸âƒ£ SCHEDULED MAINTENANCE:
   â€¢ ID: 1 âœ…
   â€¢ Total Cost: 6500.00â‚¬
   â€¢ Linked to Project âœ…

4ï¸âƒ£ EXPENSES (Total: 7):
   1. Î ÏÎ¿ÎºÎ±Ï„Î±Î²Î¿Î»Î®: 2000.00â‚¬
   2-7. Î”ÏŒÏƒÎµÎ¹Ï‚ 1-6: 750.00â‚¬ each

   ğŸ“Š Î£Î¥ÎÎŸÎ›ÎŸ: 6500.00â‚¬ âœ…

ğŸ‰ ÎŸÎ›Î•Î£ ÎŸÎ™ Î•Î Î‘Î›Î—Î˜Î•Î¥Î£Î•Î™Î£ Î Î•Î¡Î‘Î£Î‘Î!
```

### ğŸ›¡ï¸ Î Î¡ÎŸÎ£Î¤Î‘Î£Î™Î‘ ÎšÎ©Î”Î™ÎšÎ‘

Î“Î¹Î± Ï„Î·Î½ Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î± Ï„Î·Ï‚ ÎºÏÎ¯ÏƒÎ¹Î¼Î·Ï‚ ÏÎ¿Î®Ï‚ Î­Ï‡Î¿Ï…Î½ Ï€ÏÎ¿ÏƒÏ„ÎµÎ¸ÎµÎ¯:

1. **Warning Comments** ÏƒÎµ ÎºÏÎ¯ÏƒÎ¹Î¼ÎµÏ‚ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚:
   - `backend/projects/views.py::approve()`
   - `backend/projects/views.py::update_project_schedule()`
   - `frontend/app/(dashboard)/projects/[id]/page.tsx`

2. **Unit Tests**:
   - `backend/projects/tests/test_offer_approval_flow.py`

3. **Git Pre-commit Hook**:
   - `.githooks/pre-commit-offer-flow`

4. **Expense Deletion Protection**:
   - `frontend/components/financial/ExpenseList.tsx`
   - Î•Î¼Ï€Î¿Î´Î¯Î¶ÎµÎ¹ Î´Î¹Î±Î³ÏÎ±Ï†Î® Î´Î±Ï€Î±Î½ÏÎ½ Î±Ï€ÏŒ Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î­Î½Î± Î­ÏÎ³Î±
   - Î‘Î½Î±ÎºÎ±Ï„ÎµÏ…Î¸ÏÎ½ÎµÎ¹ ÏƒÏ„Î· ÏƒÎµÎ»Î¯Î´Î± Ï„Î¿Ï… Î­ÏÎ³Î¿Ï…

---

*Î¤ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·: 22 Î£ÎµÏ€Ï„ÎµÎ¼Î²ÏÎ¯Î¿Ï… 2025*
*Î•Ï€Î±Î»Î·Î¸ÎµÏÏ„Î·ÎºÎµ Î¼Îµ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ¬ Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÏƒÏ„Î· Î²Î¬ÏƒÎ· demo*