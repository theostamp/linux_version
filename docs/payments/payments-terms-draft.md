# newconcierge — Draft Όρων & Περιγραφής Υπηρεσίας Πληρωμών (Phase 1)

Έκδοση: 0.1 (draft)  
Provider (Phase 1): **Stripe Checkout** (κάρτα / SEPA)  
Πολιτική δρομολόγησης: **Two-IBAN Mode**  
- **IBAN “Client Funds”** = λειτουργικά + αποθεματικό  
- **IBAN “Office Fees”** = μόνο αμοιβές διαχείρισης

## 1. Σκοπός
Η υπηρεσία πληρωμών του newconcierge παρέχει μηχανισμό **οργάνωσης οφειλών** και **διευκόλυνσης εξόφλησης** μέσω πιστοποιημένου παρόχου πληρωμών (Payment Provider).

Η πλατφόρμα:
- δημιουργεί και προβάλλει οφειλές,
- οδηγεί τον πληρωτή σε **ασφαλές hosted checkout** του provider,
- λαμβάνει επιβεβαίωση πληρωμής μέσω **webhook**,
- ενημερώνει την κατάσταση της οφειλής και παράγει αναφορές συμφωνίας.

Η πλατφόρμα **δεν** αποθηκεύει στοιχεία κάρτας και **δεν** εκτελεί η ίδια την πληρωμή. Η πληρωμή ολοκληρώνεται στο περιβάλλον του provider.

## 2. Ορισμοί
- **Γραφείο Διαχείρισης (Office Manager / Tenant):** Η εταιρεία διαχείρισης που χρησιμοποιεί την πλατφόρμα ως “tenant”.
- **Κτίριο (Building):** Πολυκατοικία που ανήκει σε tenant.
- **Ένοικος (Resident):** Χρήστης που βλέπει και εξοφλεί οφειλές.
- **Εσωτερικός Διαχειριστής (Building Manager):** Χρήστης που παρακολουθεί/διαχειρίζεται οφειλές στο επίπεδο κτιρίου.
- **Οφειλή (Charge):** Καταχώριση ποσού προς πληρωμή για συγκεκριμένο σκοπό/περίοδο.
- **Κατηγορία Οφειλής:** `operational` (τρέχοντα), `reserve` (αποθεματικό), `fee` (αμοιβή διαχείρισης).

## 3. Ρόλοι και ευθύνες
### 3.1 Γραφείο Διαχείρισης
- Δημιουργεί/εγκρίνει οφειλές και ορίζει κατηγορία.
- Ορίζει **IBAN “Client Funds”** και **IBAN “Office Fees”**.
- Εκδίδει τα αντίστοιχα παραστατικά για τις αμοιβές διαχείρισης όπου απαιτείται.
- Είναι υπεύθυνο για τη λογιστική και φορολογική απεικόνιση των αμοιβών του.

### 3.2 Εσωτερικός Διαχειριστής
- Παρακολουθεί οφειλές/εξοφλήσεις, υπόλοιπα και αναφορές.
- Μπορεί (εφόσον ενεργοποιηθεί) να καταχωρεί **χειροκίνητες πληρωμές** (π.χ. μετρητά/τραπεζική κατάθεση) με πλήρες ίχνος ενεργειών (audit).

### 3.3 Ένοικος
- Πληρώνει οφειλές μέσω του provider.
- Ενημερώνεται για την κατάσταση πληρωμής (pending/paid/failed).

## 4. Τι κάνει η πλατφόρμα
- Προβάλλει οφειλές, προθεσμίες, κατηγορίες.
- Παρέχει κουμπί “Πληρωμή” που οδηγεί σε hosted checkout.
- Ενημερώνει αυτόματα την οφειλή μετά από επιβεβαίωση μέσω webhook.
- Διατηρεί ιστορικό πληρωμών, timestamps, αναφορές συμφωνίας, και εξαγωγές (CSV).

## 5. Τι δεν κάνει η πλατφόρμα
- Δεν εκδίδει φορολογικά παραστατικά αντί του Γραφείου Διαχείρισης.
- Δεν εγγυάται ότι η φορολογική/λογιστική ταξινόμηση των κινήσεων θα γίνει με συγκεκριμένο τρόπο (η ευθύνη παραμένει στο Γραφείο, σε συνεργασία με τον λογιστή του).
- Δεν αποθηκεύει/επεξεργάζεται ευαίσθητα στοιχεία καρτών.

## 6. Κατηγορίες χρημάτων και δρομολόγηση (Two-IBAN Mode)
Η πλατφόρμα διαχειρίζεται **κατηγορίες οφειλών**. Η κατηγορία καθορίζει **που κατευθύνεται** η πληρωμή:

- `operational` + `reserve` → **IBAN “Client Funds”**  
  (χρήματα πολυκατοικίας: λειτουργικά + αποθεματικό)
- `fee` → **IBAN “Office Fees”**  
  (αμοιβές διαχείρισης)

> Σημείωση: Η πλατφόρμα δεν “αποφασίζει” λογιστικά τι είναι έσοδο. Επιβάλλει όμως λειτουργικό διαχωρισμό ώστε οι **αμοιβές** να μην αναμειγνύονται με τα **κεφάλαια πολυκατοικιών**.

## 7. Ροή πληρωμής
1. Ο ένοικος επιλέγει οφειλή και πατά “Πληρωμή”.
2. Η πλατφόρμα δημιουργεί Checkout Session στον provider και επιστρέφει URL.
3. Ο ένοικος ολοκληρώνει την πληρωμή στο hosted checkout.
4. Ο provider αποστέλλει webhook event. Η πλατφόρμα το επαληθεύει και ενημερώνει την οφειλή.
5. Ο ένοικος και το γραφείο βλέπουν ενημέρωση (status + timestamp + αναφορά συναλλαγής).

## 8. Προμήθειες / κόστη
Οι χρεώσεις συναλλαγών καθορίζονται από τον provider και το εμπορικό πλάνο. Η πλατφόρμα μπορεί να ενσωματώνει το λειτουργικό κόστος της υποδομής πληρωμών στη συνδρομή της.

## 9. Ασφάλεια, απόδειξη και ίχνος ενεργειών
- Η πλατφόρμα αποθηκεύει μόνο τεχνικά στοιχεία συναλλαγών και αναφορές provider.
- Όλες οι αλλαγές κρίσιμων πεδίων (κατηγορία, ποσό, manual mark-paid, ακύρωση) καταγράφονται σε audit log.
- Τα webhooks επαληθεύονται και εφαρμόζεται idempotency ώστε το ίδιο event να μην επεξεργάζεται δύο φορές.

## 10. Περιορισμοί και αποποιήσεις
- Πιθανές διαφορές μεταξύ τραπεζικών κινήσεων και αναφορών provider αντιμετωπίζονται μέσω του dashboard συμφωνίας και των εξαγωγών.
- Το τελικό νομικό/λογιστικό πλαίσιο πρέπει να επιβεβαιωθεί από τον λογιστή/νομικό σύμβουλο του Γραφείου Διαχείρισης.
