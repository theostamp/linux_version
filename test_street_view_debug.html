<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Street View Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; font-family: monospace; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        img { max-width: 100%; height: auto; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Street View Debug Test</h1>
    
    <div class="test-section">
        <h3>1. Test Street View API Direct Call</h3>
        <button onclick="testDirectStreetView()">Test Direct Street View</button>
        <div id="direct-result"></div>
    </div>

    <div class="test-section">
        <h3>2. Test Form Data Preparation</h3>
        <button onclick="testFormData()">Test Form Data</button>
        <div id="form-result"></div>
    </div>

    <div class="test-section">
        <h3>3. Test Backend API Call</h3>
        <button onclick="testBackendCall()">Test Backend</button>
        <div id="backend-result"></div>
    </div>

    <div class="log" id="log"></div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
            console.log(message);
        }

        function testDirectStreetView() {
            log('ğŸ§ª Testing direct Street View API call...');
            
            // Test coordinates (Athens center)
            const testCoords = { lat: 37.9838, lng: 23.7275 };
            const apiKey = 'YOUR_API_KEY_HERE'; // Replace with actual key
            
            if (!apiKey || apiKey === 'YOUR_API_KEY_HERE') {
                log('âŒ Please set your Google Maps API key in the script');
                return;
            }
            
            const url = `https://maps.googleapis.com/maps/api/streetview?size=600x300&location=${testCoords.lat},${testCoords.lng}&heading=0&pitch=0&fov=80&key=${apiKey}`;
            log('ğŸ”— Generated URL: ' + url.substring(0, 80) + '...');
            
            const img = new Image();
            img.onload = () => {
                log('âœ… Street View image loaded successfully');
                document.getElementById('direct-result').innerHTML = `<img src="${url}" alt="Street View Test">`;
            };
            img.onerror = () => {
                log('âŒ Failed to load Street View image');
            };
            img.src = url;
        }

        function testFormData() {
            log('ğŸ§ª Testing form data preparation...');
            
            // Simulate form data with street view image
            const mockFormData = {
                name: 'Test Building',
                address: 'Î Î»Î±Ï„ÎµÎ¯Î± Î£Ï…Î½Ï„Î¬Î³Î¼Î±Ï„Î¿Ï‚, Î‘Î¸Î®Î½Î±',
                city: 'Î‘Î¸Î®Î½Î±',
                postal_code: '10563',
                apartments_count: 10,
                latitude: 37.9838,
                longitude: 23.7275,
                street_view_image: 'https://maps.googleapis.com/maps/api/streetview?size=600x300&location=37.9838,23.7275&heading=0&pitch=0&fov=80&key=TEST_KEY'
            };
            
            log('ğŸ“¤ Form data prepared:');
            log('- Name: ' + mockFormData.name);
            log('- Address: ' + mockFormData.address);
            log('- Street View Image: ' + (mockFormData.street_view_image ? 'Present' : 'Missing'));
            log('- Street View URL length: ' + (mockFormData.street_view_image ? mockFormData.street_view_image.length : 0));
            
            document.getElementById('form-result').innerHTML = '<pre>' + JSON.stringify(mockFormData, null, 2) + '</pre>';
            
            if (mockFormData.street_view_image) {
                log('âœ… Street view image is included in form data');
            } else {
                log('âŒ Street view image is NOT included in form data');
            }
        }

        async function testBackendCall() {
            log('ğŸ§ª Testing backend API call...');
            
            const mockPayload = {
                name: 'Test Building API',
                address: 'Î Î»Î±Ï„ÎµÎ¯Î± Î£Ï…Î½Ï„Î¬Î³Î¼Î±Ï„Î¿Ï‚, Î‘Î¸Î®Î½Î±',
                city: 'Î‘Î¸Î®Î½Î±',
                postal_code: '10563',
                apartments_count: 10,
                latitude: 37.9838,
                longitude: 23.7275,
                street_view_image: 'https://maps.googleapis.com/maps/api/streetview?size=600x300&location=37.9838,23.7275&heading=0&pitch=0&fov=80&key=TEST_KEY'
            };
            
            log('ğŸ“¤ Sending to backend: ' + JSON.stringify(mockPayload, null, 2));
            
            try {
                const response = await fetch('http://demo.localhost:8000/api/buildings/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer YOUR_TOKEN_HERE' // Replace with actual token
                    },
                    body: JSON.stringify(mockPayload)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    log('âœ… Backend call successful');
                    log('ğŸ“¥ Response: ' + JSON.stringify(result, null, 2));
                    document.getElementById('backend-result').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
                } else {
                    const error = await response.text();
                    log('âŒ Backend call failed: ' + response.status + ' - ' + error);
                    document.getElementById('backend-result').innerHTML = '<div style="color: red;">Error: ' + response.status + ' - ' + error + '</div>';
                }
            } catch (error) {
                log('âŒ Network error: ' + error.message);
                document.getElementById('backend-result').innerHTML = '<div style="color: red;">Network Error: ' + error.message + '</div>';
            }
        }

        // Initialize
        log('ğŸš€ Street View Debug Test initialized');
        log('ğŸ“‹ Instructions:');
        log('1. Replace YOUR_API_KEY_HERE with your actual Google Maps API key');
        log('2. Replace YOUR_TOKEN_HERE with a valid authentication token');
        log('3. Run tests in order to debug the Street View flow');
    </script>
</body>
</html>