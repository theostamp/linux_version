version: '3.8'

services:
  kiosk-simulation:
    build: .
    ports:
      - "5900:5900"  # VNC port
      - "3000:3000"  # Web interface port
    environment:
      - DISPLAY=:1
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
    devices:
      - /dev/snd:/dev/snd
    privileged: true
    command: >
      bash -c "
        Xvfb :1 -screen 0 1024x768x24 &
        export DISPLAY=:1
        fluxbox &
        x11vnc -display :1 -nopw -listen localhost -xkb -ncache 10 -ncache_cr -forever &
        sleep 5
        /home/kiosk/kiosk.sh
      "
