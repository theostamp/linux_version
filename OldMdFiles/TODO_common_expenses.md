## Αλγόριθμος Υπολογισμού Κοινοχρήστων
✅ **ΟΛΟΚΛΗΡΩΜΕΝΟ** - Backend υλοποιήθηκε επιτυχώς!

▶️ Φάση 1: Προετοιμασία & Δεδομένα Εισόδου
Πριν ξεκινήσει ο υπολογισμός, ο αλγόριθμος πρέπει να έχει πρόσβαση στα παρακάτω δεδομένα για την τρέχουσα περίοδο (π.χ. "Ιούλιος 2025"):

Λίστα Διαμερισμάτων: Για κάθε διαμέρισμα, χρειαζόμαστε:

ID_Διαμερίσματος

Ονοματεπώνυμο

Χιλιοστά_Γενικών_Δαπανών

Χιλιοστά_Ανελκυστήρα

Χιλιοστά_Θέρμανσης (για το πάγιο)

Προηγούμενο_Υπόλοιπο (θετικό αν χρωστάει, αρνητικό αν έχει πιστωτικό)

Λίστα Δαπανών: Μια λίστα με όλες τις δαπάνες του μήνα. Για κάθε δαπάνη:

Περιγραφή_Δαπάνης

Ποσό_Δαπάνης

Κανόνας_Κατανομής (π.χ. ΓΕΝΙΚΗ, ΑΝΕΛΚΥΣΤΗΡΑΣ, ΘΕΡΜΑΝΣΗ, ΙΣΟΠΟΣΑ, ΑΤΟΜΙΚΗ)

ID_Διαμερίσματος_Προορισμού (μόνο για τον κανόνα ΑΤΟΜΙΚΗ)

Μετρήσεις Θέρμανσης:

Συνολικές_Ώρες_Κατανάλωσης: Το άθροισμα των ωρών από όλους τους ωρομετρητές.

Για κάθε διαμέρισμα, οι Ώρες_Κατανάλωσης του.

Παράμετροι Υπολογισμού:

Ποσοστό_Παγίου_Θέρμανσης (π.χ. 30% ή 0.30)

Πάγια_Εισφορά_Αποθεματικού (π.χ. 5€ ανά διαμέρισμα)

▶️ Φάση 2: Εκτέλεση Αλγορίθμου
✅ **ΟΛΟΚΛΗΡΩΜΕΝΟ** - Υλοποιήθηκε στο AdvancedCommonExpenseCalculator
Βήμα 1: Αρχικοποίηση Μεταβλητών

Δημιούργησε μια λίστα Τελικά_Ποσά για κάθε διαμέρισμα, αρχικοποιώντας την στο μηδέν.

Υπολόγισε τα συνολικά ποσά ανά κατηγορία δαπάνης:

Σύνολο_Γενικών_Δαπανών = Άθροισμα ποσών όλων των δαπανών με κανόνα ΓΕΝΙΚΗ.

Σύνολο_Δαπανών_Ανελκυστήρα = Άθροισμα ποσών όλων των δαπανών με κανόνα ΑΝΕΛΚΥΣΤΗΡΑΣ.

Σύνολο_Κόστους_Θέρμανσης = Άθροισμα ποσών όλων των δαπανών με κανόνα ΘΕΡΜΑΝΣΗ.

Σύνολο_Ισόποσων_Δαπανών = Άθροισμα ποσών όλων των δαπανών με κανόνα ΙΣΟΠΟΣΑ.

Βήμα 2: Υπολογισμός Δαπανών Θέρμανσης (το πιο σύνθετο σημείο)

Ποσό_Παγίου_Θέρμανσης = Σύνολο_Κόστους_Θέρμανσης * Ποσοστό_Παγίου_Θέρμανσης.

Ποσό_Μεταβλητό_Θέρμανσης = Σύνολο_Κόστους_Θέρμανσης - Ποσό_Παγίου_Θέρμανσης.

Αν Συνολικές_Ώρες_Κατανάλωσης > 0:

Κόστος_Ανά_Ώρα = Ποσό_Μεταβλητό_Θέρμανσης / Συνολικές_Ώρες_Κατανάλωσης.

Αλλιώς:

Κόστος_Ανά_Ώρα = 0.

Βήμα 3: Κατανομή Δαπανών ανά Διαμέρισμα

Για κάθε Διαμέρισμα στη Λίστα Διαμερισμάτων:

α. Υπολογισμός Γενικών Δαπανών:

Αναλογία_Γενικών = Σύνολο_Γενικών_Δαπανών * (Διαμέρισμα.Χιλιοστά_Γενικών_Δαπανών / 1000).

Πρόσθεσε το Αναλογία_Γενικών στο Τελικά_Ποσά του διαμερίσματος.

β. Υπολογισμός Δαπανών Ανελκυστήρα:

Αναλογία_Ανελκυστήρα = Σύνολο_Δαπανών_Ανελκυστήρα * (Διαμέρισμα.Χιλιοστά_Ανελκυστήρα / 1000).

Πρόσθεσε το Αναλογία_Ανελκυστήρα στο Τελικά_Ποσά του διαμερίσματος.

γ. Υπολογισμός Δαπανών Θέρμανσης:

Κόστος_Παγίου = Ποσό_Παγίου_Θέρμανσης * (Διαμέρισμα.Χιλιοστά_Θέρμανσης / 1000).

Κόστος_Μεταβλητό = Διαμέρισμα.Ώρες_Κατανάλωσης * Κόστος_Ανά_Ώρα.

Πρόσθεσε το Κόστος_Παγίου + Κόστος_Μεταβλητό στο Τελικά_Ποσά του διαμερίσματος.

δ. Υπολογισμός Ισόποσων Δαπανών:

Αναλογία_Ισόποση = Σύνολο_Ισόποσων_Δαπανών / Πλήθος_Διαμερισμάτων.

Πρόσθεσε το Αναλογία_Ισόποση στο Τελικά_Ποσά του διαμερίσματος.

Βήμα 4: Προσθήκη Ατομικών Χρεώσεων

Για κάθε Δαπάνη στη Λίστα Δαπανών:

Αν Δαπάνη.Κανόνας_Κατανομής == ΑΤΟΜΙΚΗ:

Βρες το Τελικό_Ποσό για το Δαπάνη.ID_Διαμερίσματος_Προορισμού.

Πρόσθεσε το Δαπάνη.Ποσό_Δαπάνης σε αυτό το ποσό.

Βήμα 5: Οριστικοποίηση Τελικών Ποσών

Για κάθε Διαμέρισμα στη Λίστα Διαμερισμάτων:

α. Πρόσθεσε την Εισφορά Αποθεματικού:

Πρόσθεσε το Πάγια_Εισφορά_Αποθεματικού στο Τελικά_Ποσά του διαμερίσματος.

β. Υπολόγισε το Συνολικό Πληρωτέο Ποσό:

Συνολικό_Πληρωτέο = Τελικά_Ποσά[Διαμέρισμα.ID] + Διαμέρισμα.Προηγούμενο_Υπόλοιπο.

▶️ Φάση 3: Αποτέλεσμα (Output)
✅ **ΟΛΟΚΛΗΡΩΜΕΝΟ** - API endpoint /api/common-expenses/calculate_advanced/
Το αποτέλεσμα του αλγορίθμου για κάθε διαμέρισμα θα είναι ένα αντικείμενο που περιέχει:

ID_Διαμερίσματος

Ονοματεπώνυμο

Ανάλυση Χρεώσεων:

Χρέωση_Γενικών_Δαπανών

Χρέωση_Ανελκυστήρα

Χρέωση_Θέρμανσης (ιδανικά με ανάλυση σε πάγιο και μεταβλητό)

Χρέωση_Ισόποσων_Δαπανών

Λίστα_Ατομικών_Χρεώσεων

Εισφορά_Αποθεματικού

Σύνοψη:

Υποσύνολο_Περιόδου (το άθροισμα των παραπάνω)

Προηγούμενο_Υπόλοιπο

ΤΕΛΙΚΟ_ΠΛΗΡΩΤΕΟ_ΠΟΣΟ

✅ **ΟΛΟΚΛΗΡΩΜΕΝΟ** - Αυτός ο αλγόριθμος έχει υλοποιηθεί επιτυχώς στο AdvancedCommonExpenseCalculator και είναι έτοιμος για χρήση.

---

## 🎯 Επόμενα Βήματα - Frontend Integration

### 🔄 Τρέχουσα Κατάσταση
- ✅ Backend αλγόριθμος υλοποιήθηκε
- ✅ API endpoint διαθέσιμο
- ✅ Testάριστηκε επιτυχώς
- 🔄 **Frontend integration σε εξέλιξη**

### 📋 Επόμενα Βήματα
1. **Ενσωμάτωση στο Frontend**
   - Ενημέρωση CommonExpenseCalculator.tsx
   - Προσθήκη επιλογής προηγμένου υπολογιστή
   - Εμφάνιση λεπτομερούς ανάλυσης

2. **Test με Πραγματικά Δεδομένα**
   - Έλεγχος λειτουργικότητας
   - Επιβεβαίωση υπολογισμών

3. **Βελτιώσεις**
   - Ατομικές χρεώσεις
   - Παράμετροι υπολογισμού
   - Αναφορές

**📖 Δείτε το αρχείο `NEXT_SESSION_ADVANCED_CALCULATOR_FRONTEND.md` για λεπτομερείς οδηγίες.**