# ğŸ¬ Kiosk Scenes - Î‘ÏÏ‡Î¹Ï„ÎµÎºÏ„Î¿Î½Î¹ÎºÎ® Î”Ï…Î½Î±Î¼Î¹ÎºÏÎ½ Layouts

## ğŸ¯ 1. Î£Ï„ÏŒÏ‡Î¿Ï‚

Î‘Ï…Ï„ÏŒ Ï„Î¿ Î­Î³Î³ÏÎ±Ï†Î¿ Ï€ÎµÏÎ¹Î³ÏÎ¬Ï†ÎµÎ¹ Ï„Î·Î½ Ï„ÎµÏ‡Î½Î¹ÎºÎ® Î±ÏÏ‡Î¹Ï„ÎµÎºÏ„Î¿Î½Î¹ÎºÎ® Î³Î¹Î± Ï„Î· Î¼ÎµÏ„Î¬Î²Î±ÏƒÎ· Ï„Î¿Ï… Kiosk Î±Ï€ÏŒ Î­Î½Î± ÏƒÏ„Î±Ï„Î¹ÎºÏŒ, ÎµÎ½Î¹Î±Î¯Î¿ layout ÏƒÎµ Î­Î½Î± Î´Ï…Î½Î±Î¼Î¹ÎºÏŒ ÏƒÏÏƒÏ„Î·Î¼Î± **"Î£ÎºÎ·Î½ÏÎ½" (Scenes)**. ÎŸ ÏƒÏ„ÏŒÏ‡Î¿Ï‚ ÎµÎ¯Î½Î±Î¹ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¸ÎµÎ¯ Î¼Î¹Î± Ï€Î¹Î¿ Î¶Ï‰Î½Ï„Î±Î½Î®, ÎµÎ»ÎºÏ…ÏƒÏ„Î¹ÎºÎ® ÎºÎ±Î¹ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ® Î¼Îµ Ï„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ ÎµÎ¼Ï€ÎµÎ¹ÏÎ¯Î± Î³Î¹Î± Ï„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î·, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ ÎµÎ½Î±Î»Î»Î±Î³Î® Î¼ÎµÏ„Î±Î¾Ï Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÏÎ½ Î´Î¹Î±Ï„Î¬Î¾ÎµÏ‰Î½ ÎºÎ±Î¹ Î¸ÎµÎ¼Î±Ï„Î¹ÎºÏÎ½ ÎµÎ½Î¿Ï„Î®Ï„Ï‰Î½.

---

## æ ¸å¿ƒ 2. Î’Î±ÏƒÎ¹ÎºÎ­Ï‚ ÎˆÎ½Î½Î¿Î¹ÎµÏ‚

-   **Î£ÎºÎ·Î½Î® (Scene):** ÎœÎ¹Î± "Î£ÎºÎ·Î½Î®" ÎµÎ¯Î½Î±Î¹ Î­Î½Î± Ï€Î»Î®ÏÎµÏ‚, Î±Ï…Ï„ÏŒÎ½Î¿Î¼Î¿ layout Î³Î¹Î± Ï„Î·Î½ Î¿Î¸ÏŒÎ½Î· Ï„Î¿Ï… Kiosk. ÎšÎ¬Î¸Îµ ÏƒÎºÎ·Î½Î® Î¿ÏÎ¯Î¶ÎµÎ¹:
    -   Î Î¿Î¹Î± widgets ÎµÎ¼Ï†Î±Î½Î¯Î¶Î¿Î½Ï„Î±Î¹.
    -   Î Î¿Ï ÎºÎ±Î¹ Ï€ÏŒÏƒÎ¿ Î¼ÎµÎ³Î¬Î»Î¿ ÎµÎ¼Ï†Î±Î½Î¯Î¶ÎµÏ„Î±Î¹ ÎºÎ¬Î¸Îµ widget (Î· Î¸Î­ÏƒÎ· ÎºÎ±Î¹ Ï„Î¿ Î¼Î­Î³ÎµÎ¸ÏŒÏ‚ Ï„Î¿Ï… ÏƒÏ„Î¿ grid).
    -   Î ÏŒÏƒÎ· ÏÏÎ± Î¸Î± Ï€Î±ÏÎ±Î¼ÎµÎ¯Î½ÎµÎ¹ ÎµÎ½ÎµÏÎ³Î® Î· ÏƒÎºÎ·Î½Î® (`duration`).
    -   Î ÏÏ‚ Î¸Î± Î³Î¯Î½ÎµÎ¹ Î· Î¼ÎµÏ„Î¬Î²Î±ÏƒÎ· ÏƒÏ„Î·Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· ÏƒÎºÎ·Î½Î® (`transition`).
    -   Î ÏŒÏ„Îµ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³Î® (Ï€.Ï‡. ÎºÎ±Î½ÏŒÎ½ÎµÏ‚ Î²Î¬ÏƒÎµÎ¹ ÏÏÎ±Ï‚).

-   **ÎšÏÎºÎ»Î¿Ï‚ Î£ÎºÎ·Î½ÏÎ½ (Scene Cycle):** Î¤Î¿ Kiosk Î´ÎµÎ½ Î¸Î± ÎµÎ½Î±Î»Î»Î¬ÏƒÏƒÎµÎ¹ Ï€Î»Î­Î¿Î½ Î¼ÎµÎ¼Î¿Î½Ï‰Î¼Î­Î½Î± widgets, Î±Î»Î»Î¬ Î¿Î»ÏŒÎºÎ»Î·ÏÎµÏ‚ "Î£ÎºÎ·Î½Î­Ï‚" ÏƒÎµ Î­Î½Î±Î½ Ï€ÏÎ¿ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î¿ Î® Î´Ï…Î½Î±Î¼Î¹ÎºÏŒ ÎºÏÎºÎ»Î¿.

---

## ğŸ—ï¸ 3. Î‘ÏÏ‡Î¹Ï„ÎµÎºÏ„Î¿Î½Î¹ÎºÎ®

Î— Î½Î­Î± Î±ÏÏ‡Î¹Ï„ÎµÎºÏ„Î¿Î½Î¹ÎºÎ® ÎµÏ€ÎµÎºÏ„ÎµÎ¯Î½ÎµÎ¹ Ï„Î¿ Ï…Ï€Î¬ÏÏ‡Î¿Î½ ÏƒÏÏƒÏ„Î·Î¼Î± Ï„Î¿Ï… `Canvas Editor` ÎºÎ±Î¹ Ï„Ï‰Î½ widgets, ÎµÎ¹ÏƒÎ¬Î³Î¿Î½Ï„Î±Ï‚ Î½Î­Î± Î¼Î¿Î½Ï„Î­Î»Î± ÏƒÏ„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î³Î¹Î± Ï„Î·Î½ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Ï„Ï‰Î½ ÏƒÎºÎ·Î½ÏÎ½.

```mermaid
graph TD
    subgraph "Admin Dashboard"
        A[1. Canvas Editor] --> B{2. Scene Manager UI};
        B -- saves --> C[3. API: /api/kiosk/scenes/];
    end

    subgraph "Backend"
        C --> D[4. KioskScene Model];
        C --> E[5. WidgetPlacement Model];
    end

    subgraph "Kiosk Display"
        F[6. KioskSceneRenderer] -- fetches --> G[7. API: /api/kiosk/scenes/active/];
        G --> F;
        F -- renders --> H[8. Dynamic Grid Layout];
    end

    D & E -- are read by --> G;
    H --> I[9. Widgets];

```

---

## ğŸ”© 4. Î¤ÎµÏ‡Î½Î¹ÎºÎ® Î¥Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ· (Backend)

Î˜Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎ¿Ï…Î¼Îµ Î´ÏÎ¿ Î½Î­Î± Î¼Î¿Î½Ï„Î­Î»Î± Î³Î¹Î± Î½Î± Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾Î¿Ï…Î¼Îµ Ï„Î¹Ï‚ Î£ÎºÎ·Î½Î­Ï‚.

### ÎÎ­Î± Models (`kiosk/models.py`)

1.  **`KioskScene`**: Î‘Ï€Î¿Î¸Î·ÎºÎµÏÎµÎ¹ Ï„Î¹Ï‚ Î¹Î´Î¹ÏŒÏ„Î·Ï„ÎµÏ‚ ÎºÎ¬Î¸Îµ ÏƒÎºÎ·Î½Î®Ï‚.

    ```python
    class KioskScene(models.Model):
        kiosk_config = models.ForeignKey('KioskWidgetConfig', on_delete=models.CASCADE, related_name='scenes')
        name = models.CharField(max_length=100)
        order = models.PositiveIntegerField(default=0)
        duration_seconds = models.PositiveIntegerField(default=30, help_text="Duration in seconds")
        transition = models.CharField(max_length=50, default='fade') # e.g., 'fade', 'slide'
        is_enabled = models.BooleanField(default=True)
        
        # Time-based activation (optional)
        active_start_time = models.TimeField(null=True, blank=True)
        active_end_time = models.TimeField(null=True, blank=True)

        class Meta:
            ordering = ['order']
    ```

2.  **`WidgetPlacement`**: ÎŸÏÎ¯Î¶ÎµÎ¹ Ï„Î· Î¸Î­ÏƒÎ· ÎºÎ±Î¹ Ï„Î¿ Î¼Î­Î³ÎµÎ¸Î¿Ï‚ ÎµÎ½ÏŒÏ‚ widget Î¼Î­ÏƒÎ± ÏƒÎµ Î¼Î¹Î± ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· ÏƒÎºÎ·Î½Î®.

    ```python
    class WidgetPlacement(models.Model):
        scene = models.ForeignKey(KioskScene, on_delete=models.CASCADE, related_name='placements')
        widget = models.ForeignKey('KioskWidget', on_delete=models.CASCADE) # Assuming a KioskWidget model exists
        
        # Grid properties from Canvas Editor
        grid_row_start = models.PositiveIntegerField()
        grid_col_start = models.PositiveIntegerField()
        grid_row_end = models.PositiveIntegerField()
        grid_col_end = models.PositiveIntegerField()

        class Meta:
            unique_together = ('scene', 'widget')
    ```

### ÎÎ­Î± API Endpoints (`kiosk/views.py`)

-   `GET /api/kiosk/scenes/`: Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ ÏƒÎºÎ·Î½Î­Ï‚ (Î¼Îµ Ï„Î± placements Ï„Î¿Ï…Ï‚) Î³Î¹Î± Î­Î½Î± ÎºÏ„Î¯ÏÎ¹Î¿, Î³Î¹Î± Ï‡ÏÎ®ÏƒÎ· ÏƒÏ„Î¿Î½ editor.
-   `POST, PUT, DELETE /api/kiosk/scenes/{id}/`: CRUD endpoints Î³Î¹Î± Ï„Î· Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï„Ï‰Î½ ÏƒÎºÎ·Î½ÏÎ½.
-   `GET /api/kiosk/scenes/active/`: ÎˆÎ½Î± "Î­Î¾Ï…Ï€Î½Î¿" endpoint Ï€Î¿Ï… ÎµÏ€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ **Î¼ÏŒÎ½Î¿** Ï„Î¹Ï‚ ÎµÎ½ÎµÏÎ³Î­Ï‚ ÏƒÎºÎ·Î½Î­Ï‚ Î³Î¹Î± Ï„Î·Î½ Ï„ÏÎ­Ï‡Î¿Ï…ÏƒÎ± ÏÏÎ±, Î­Ï„Î¿Î¹Î¼ÎµÏ‚ Î³Î¹Î± rendering Î±Ï€ÏŒ Ï„Î¿ Kiosk.

---

## âœ¨ 5. Î¤ÎµÏ‡Î½Î¹ÎºÎ® Î¥Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ· (Frontend)

### `KioskSceneRenderer.tsx`

Î‘Ï…Ï„ÏŒ Ï„Î¿ Î½Î­Î¿ component Î¸Î± Î±Î½Ï„Î¹ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÎµÎ¹ Ï„Î¿ `KioskWidgetRenderer` ÎºÎ±Î¹ Î¸Î± ÎµÎ¯Î½Î±Î¹ Î· ÎºÎ±ÏÎ´Î¹Î¬ Ï„Î¿Ï… display.

**Î›Î¿Î³Î¹ÎºÎ®:**
1.  **Fetch Data:** ÎšÎ±Ï„Î¬ Ï„Î·Î½ Î­Î½Î±ÏÎ¾Î·, ÎºÎ±Î»ÎµÎ¯ Ï„Î¿ `GET /api/kiosk/scenes/active/` Î³Î¹Î± Î½Î± Ï€Î¬ÏÎµÎ¹ Ï„Î· Î»Î¯ÏƒÏ„Î± Ï„Ï‰Î½ ÎµÎ½ÎµÏÎ³ÏÎ½ ÏƒÎºÎ·Î½ÏÎ½.
2.  **State Management:** Î”Î¹Î±Ï„Î·ÏÎµÎ¯ state Î³Î¹Î±:
    -   `scenes`: Î— Î»Î¯ÏƒÏ„Î± Ï„Ï‰Î½ ÏƒÎºÎ·Î½ÏÎ½.
    -   `currentSceneIndex`: ÎŸ Î´ÎµÎ¯ÎºÏ„Î·Ï‚ Ï„Î·Ï‚ Ï„ÏÎ­Ï‡Î¿Ï…ÏƒÎ±Ï‚ ÏƒÎºÎ·Î½Î®Ï‚.
3.  **Scene Cycler:** Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Î­Î½Î± `useEffect` Î¼Îµ `setTimeout` Î³Î¹Î± Ï„Î·Î½ ÎµÎ½Î±Î»Î»Î±Î³Î® Ï„Ï‰Î½ ÏƒÎºÎ·Î½ÏÎ½.
    -   Î— Î´Î¹Î¬ÏÎºÎµÎ¹Î± Ï„Î¿Ï… `setTimeout` ÎºÎ±Î¸Î¿ÏÎ¯Î¶ÎµÏ„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ `scenes[currentSceneIndex].duration_seconds`.
    -   ÎŒÏ„Î±Î½ Î»Î®Î¾ÎµÎ¹ Î¿ Ï‡ÏÏŒÎ½Î¿Ï‚, Î±Ï…Î¾Î¬Î½ÎµÎ¹ Ï„Î¿ `currentSceneIndex`.
4.  **Rendering:**
    -   Î“Î¹Î± Ï„Î·Î½ `currentScene`, Î´Î¹Î±Î²Î¬Î¶ÎµÎ¹ Ï„Î± `placements`.
    -   Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ CSS Grid, Ï„Î¿Ï€Î¿Î¸ÎµÏ„ÎµÎ¯ Î´Ï…Î½Î±Î¼Î¹ÎºÎ¬ ÎºÎ¬Î¸Îµ widget ÏƒÏ„Î· ÏƒÏ‰ÏƒÏ„Î® Î¸Î­ÏƒÎ· ÎºÎ±Î¹ Î¼Îµ Ï„Î¿ ÏƒÏ‰ÏƒÏ„ÏŒ Î¼Î­Î³ÎµÎ¸Î¿Ï‚, Î²Î¬ÏƒÎµÎ¹ Ï„Ï‰Î½ `grid_row_start`, `grid_col_start` Îº.Î»Ï€.

```jsx
// Simplified logic for KioskSceneRenderer.tsx

const KioskSceneRenderer = () => {
  const { data: scenes } = useQuery('activeScenes', fetchActiveScenes);
  const [currentSceneIndex, setCurrentSceneIndex] = useState(0);

  useEffect(() => {
    if (!scenes || scenes.length === 0) return;

    const currentScene = scenes[currentSceneIndex];
    const timer = setTimeout(() => {
      setCurrentSceneIndex((prevIndex) => (prevIndex + 1) % scenes.length);
    }, currentScene.duration_seconds * 1000);

    return () => clearTimeout(timer);
  }, [currentSceneIndex, scenes]);

  const activeScene = scenes?.[currentSceneIndex];

  return (
    <div className="grid-container" style={{ /* dynamic grid styles */ }}>
      {activeScene?.placements.map(placement => (
        <div key={placement.widget.id} style={{
          gridRow: `${placement.grid_row_start} / ${placement.grid_row_end}`,
          gridColumn: `${placement.grid_col_start} / ${placement.grid_col_end}`,
        }}>
          <WidgetComponent widget={placement.widget} />
        </div>
      ))}
    </div>
  );
};
```

---

## ğŸ—ºï¸ 6. ÎœÎµÏ„Î¬Î²Î±ÏƒÎ· (Migration Path)

Î“Î¹Î± Ï„Î· Î¼ÎµÏ„Î¬Î²Î±ÏƒÎ· Î±Ï€ÏŒ Ï„Î¿ Ï€Î±Î»Î¹ÏŒ ÏƒÏÏƒÏ„Î·Î¼Î± ÏƒÏ„Î¿ Î½Î­Î¿:
1.  **Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Default Scene:** Î˜Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¸ÎµÎ¯ Î­Î½Î± management command (`python manage.py migrate_to_scenes`).
2.  **ÎœÎµÏ„Î±Ï„ÏÎ¿Ï€Î® Layout:** Î¤Î¿ script Î¸Î± Î´Î¹Î±Î²Î¬ÏƒÎµÎ¹ Ï„Î·Î½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…ÏƒÎ± ÏƒÎµÎ¹ÏÎ¬ Ï„Ï‰Î½ widgets ÎºÎ±Î¹ Î¸Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î¼Î¹Î± "Default Scene" Î¼Îµ Î­Î½Î± Î±Ï€Î»ÏŒ, ÎºÎ¬Î¸ÎµÏ„Î¿ layout, Î¼ÎµÏ„Î±Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ Ï€Î±Î»Î¹Î¬ ÏƒÎµÎ¹ÏÎ¬ ÏƒÎµ `WidgetPlacement` ÎµÎ³Î³ÏÎ±Ï†Î­Ï‚.
3.  **Backward Compatibility:** Î¤Î¿ Ï€Î±Î»Î¹ÏŒ `KioskWidgetRenderer` Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€Î±ÏÎ±Î¼ÎµÎ¯Î½ÎµÎ¹ Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î¬ Î³Î¹Î± ÎºÏ„Î¯ÏÎ¹Î± Ï€Î¿Ï… Î´ÎµÎ½ Î­Ï‡Î¿Ï…Î½ Î±ÎºÏŒÎ¼Î± "Î£ÎºÎ·Î½Î­Ï‚", Î´Î¹Î±ÏƒÏ†Î±Î»Î¯Î¶Î¿Î½Ï„Î±Ï‚ Î¿Î¼Î±Î»Î® Î¼ÎµÏ„Î¬Î²Î±ÏƒÎ·.