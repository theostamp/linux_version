# ğŸ“Š Î‘Î½Î¬Î»Ï…ÏƒÎ· ÎŸÎ¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÎ¿Ï ÎœÎ¿Î½Ï„Î­Î»Î¿Ï… - Î£Ï…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ ÎºÎ±Î¹ ÎœÎµÏ„Î±Î²Î»Î·Ï„Î­Ï‚

## ğŸ“‘ Î ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î±
- [ÎœÎ¿Î½Ï„Î­Î»Î± Î’Î¬ÏƒÎ·Ï‚ Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½](#Î¼Î¿Î½Ï„Î­Î»Î±-Î²Î¬ÏƒÎ·Ï‚-Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½)
- [Î¥Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏÎ½](#Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚-Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏÎ½)
- [API Views & Serializers](#api-views--serializers)
- [Î‘Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ· Î£Ï…ÏƒÏ„Î·Î¼Î¬Ï„Ï‰Î½](#Î±Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ·-ÏƒÏ…ÏƒÏ„Î·Î¼Î¬Ï„Ï‰Î½)

---

## ğŸ—„ï¸ ÎœÎ¿Î½Ï„Î­Î»Î± Î’Î¬ÏƒÎ·Ï‚ Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½

### 1. **Supplier** (Î ÏÎ¿Î¼Î·Î¸ÎµÏ…Ï„Î­Ï‚)
**Î‘ÏÏ‡ÎµÎ¯Î¿:** `backend/financial/models.py:7-89`

#### Î ÎµÎ´Î¯Î± (ÎœÎµÏ„Î±Î²Î»Î·Ï„Î­Ï‚):
| Î ÎµÎ´Î¯Î¿ | Î¤ÏÏ€Î¿Ï‚ | Î£ÎºÎ¿Ï€ÏŒÏ‚ |
|-------|-------|--------|
| `building` | ForeignKey | Î£ÏÎ½Î´ÎµÏƒÎ· Î¼Îµ ÎºÏ„Î¯ÏÎ¹Î¿ |
| `name` | CharField | ÎŒÎ½Î¿Î¼Î± Ï€ÏÎ¿Î¼Î·Î¸ÎµÏ…Ï„Î® |
| `category` | CharField | ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î± (Î”Î•Î—, Î½ÎµÏÏŒ, ÏƒÏ…Î½Ï„Î®ÏÎ·ÏƒÎ· ÎºÏ„Î») |
| `status` | CharField | ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· (active/inactive/suspended) |
| `contact_person` | CharField | Î¥Ï€ÎµÏÎ¸Ï…Î½Î¿Ï‚ ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚ |
| `phone`, `email` | CharField/EmailField | Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚ |
| `vat_number`, `tax_number` | CharField | Î‘Î¦Îœ |
| `contract_start_date`, `contract_end_date` | DateField | Î”Î¹Î¬ÏÎºÎµÎ¹Î± ÏƒÏ…Î¼Î²Î¿Î»Î±Î¯Î¿Ï… |
| `rating`, `reliability_score` | DecimalField | Î‘Î¾Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ· (0-5) |
| `is_active` | BooleanField | Î•Î½ÎµÏÎ³ÏŒÏ‚ Ï€ÏÎ¿Î¼Î·Î¸ÎµÏ…Ï„Î®Ï‚ |

#### Î£Ï„Î±Î¸ÎµÏÎ­Ï‚ (Choices):
```python
SUPPLIER_CATEGORIES = [
    ('electricity', 'Î”Î•Î—'), ('water', 'Î•Î¥Î”Î‘Î '), ('cleaning', 'ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚'),
    ('elevator', 'Î‘Î½ÎµÎ»ÎºÏ…ÏƒÏ„Î®ÏÎ±Ï‚'), ('heating', 'Î˜Î­ÏÎ¼Î±Î½ÏƒÎ·'), ...
]
STATUS_CHOICES = ['active', 'inactive', 'suspended', 'terminated']
```

#### ÎœÎ­Î¸Î¿Î´Î¿Î¹:
- `__str__()` â†’ Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ "ÎŒÎ½Î¿Î¼Î± - ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±"

**Î‘Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ·:**
- Î£Ï…Î½Î´Î­ÎµÏ„Î±Î¹ Î¼Îµ `Expense` (Î¼Î¹Î± Î´Î±Ï€Î¬Î½Î· Î­Ï‡ÎµÎ¹ Î­Î½Î±Î½ Ï€ÏÎ¿Î¼Î·Î¸ÎµÏ…Ï„Î®)
- Î¦Î¹Î»Ï„ÏÎ¬ÏÎµÏ„Î±Î¹ Î±Î½Î¬ `building_id` ÏƒÏ„Î¿ API

---

### 2. **Expense** (Î”Î±Ï€Î¬Î½ÎµÏ‚)
**Î‘ÏÏ‡ÎµÎ¯Î¿:** `backend/financial/models.py:92-389`

#### Î ÎµÎ´Î¯Î± (ÎœÎµÏ„Î±Î²Î»Î·Ï„Î­Ï‚):
| Î ÎµÎ´Î¯Î¿ | Î¤ÏÏ€Î¿Ï‚ | Î£ÎºÎ¿Ï€ÏŒÏ‚ |
|-------|-------|--------|
| `building` | ForeignKey | ÎšÏ„Î¯ÏÎ¹Î¿ Ï€Î¿Ï… Î±Î½Î®ÎºÎµÎ¹ Î· Î´Î±Ï€Î¬Î½Î· |
| `title` | CharField | Î¤Î¯Ï„Î»Î¿Ï‚ Î´Î±Ï€Î¬Î½Î·Ï‚ |
| `amount` | DecimalField | Î Î¿ÏƒÏŒ ÏƒÎµ ÎµÏ…ÏÏ (â‚¬) |
| `date` | DateField | Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î´Î±Ï€Î¬Î½Î·Ï‚ |
| `category` | CharField | ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î± Î´Î±Ï€Î¬Î½Î·Ï‚ (ÎºÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚, Î±Î½ÎµÎ»ÎºÏ…ÏƒÏ„Î®ÏÎ±Ï‚ ÎºÏ„Î») |
| `expense_type` | CharField | Î¤ÏÏ€Î¿Ï‚ (regular/management_fee/reserve_fund/auto_generated) |
| `distribution_type` | CharField | Î¤ÏÏŒÏ€Î¿Ï‚ ÎºÎ±Ï„Î±Î½Î¿Î¼Î®Ï‚ (by_participation_mills/equal_share/by_meters) |
| `payer_responsibility` | CharField | Î Î»Î·ÏÏÎ½ÎµÎ¹: Î™Î´Î¹Î¿ÎºÏ„Î®Ï„Î·Ï‚/ÎˆÎ½Î¿Î¹ÎºÎ¿Ï‚/ÎšÎ¿Î¹Î½Î¬ |
| `supplier` | ForeignKey | Î£ÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Ï€ÏÎ¿Î¼Î·Î¸ÎµÏ…Ï„Î® |
| `project` | ForeignKey | Î£ÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Î­ÏÎ³Î¿ (projects.Project) |
| `audit_trail` | JSONField | Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ Î±Î»Î»Î±Î³ÏÎ½ |
| `attachment` | FileField | Î•Ï€Î¹ÏƒÏ…Î½Î±Ï€Ï„ÏŒÎ¼ÎµÎ½Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ |
| `notes` | TextField | Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚ |
| `due_date` | DateField | Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Ï€Î»Î·ÏÏ‰Î¼Î®Ï‚ |
| `add_to_calendar` | BooleanField | Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏƒÏ„Î¿ Î·Î¼ÎµÏÎ¿Î»ÏŒÎ³Î¹Î¿ |

#### Î£Ï„Î±Î¸ÎµÏÎ­Ï‚ (Choices):
```python
EXPENSE_TYPE_CHOICES = [
    ('regular', 'ÎšÎ±Î½Î¿Î½Î¹ÎºÎ® Î”Î±Ï€Î¬Î½Î·'),
    ('management_fee', 'Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î¹ÎºÎ¬ ÎˆÎ¾Î¿Î´Î±'),
    ('reserve_fund', 'Î•Î¹ÏƒÏ†Î¿ÏÎ¬ Î‘Ï€Î¿Î¸ÎµÎ¼Î±Ï„Î¹ÎºÎ¿Ï'),
    ('auto_generated', 'Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î”Î±Ï€Î¬Î½Î·')
]

EXPENSE_CATEGORIES = [
    # Î Î¬Î³Î¹ÎµÏ‚ Î”Î±Ï€Î¬Î½ÎµÏ‚
    ('cleaning', 'ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚'), ('electricity_common', 'Î”Î•Î— ÎšÎ¿Î¹Î½Î¿Ï‡ÏÎ®ÏƒÏ„Ï‰Î½'),
    ('water_common', 'ÎÎµÏÏŒ'), ('garbage_collection', 'Î‘Ï€Î¿ÏÏÎ¯Î¼Î¼Î±Ï„Î±'),

    # Î‘Î½ÎµÎ»ÎºÏ…ÏƒÏ„Î®ÏÎ±Ï‚
    ('elevator_maintenance', 'Î£Ï…Î½Ï„Î®ÏÎ·ÏƒÎ·'), ('elevator_repair', 'Î•Ï€Î¹ÏƒÎºÎµÏ…Î®'),

    # Î˜Î­ÏÎ¼Î±Î½ÏƒÎ·
    ('heating_fuel', 'Î ÎµÏ„ÏÎ­Î»Î±Î¹Î¿'), ('heating_maintenance', 'Î£Ï…Î½Ï„Î®ÏÎ·ÏƒÎ· ÎšÎ±Ï…ÏƒÏ„Î®ÏÎ±'),

    # ÎšÏ„Î¯ÏÎ¹Î¿
    ('building_insurance', 'Î‘ÏƒÏ†Î¬Î»ÎµÎ¹Î±'), ('roof_repair', 'Î•Ï€Î¹ÏƒÎºÎµÏ…Î® Î£Ï„Î­Î³Î·Ï‚'),
    ('facade_repair', 'Î•Ï€Î¹ÏƒÎºÎµÏ…Î® Î ÏÏŒÏƒÎ¿ÏˆÎ·Ï‚'),

    # Î”Î¹Î¿Î¹ÎºÎ·Ï„Î¹ÎºÎ¬
    ('legal_fees', 'Î”Î¹ÎºÎ±ÏƒÏ„Î¹ÎºÎ¬ ÎˆÎ¾Î¿Î´Î±'), ('accounting_fees', 'Î›Î¿Î³Î¹ÏƒÏ„Î¹ÎºÎ¬'),
    ('management_fees', 'Î”Î¹Î¿Î¹ÎºÎ·Ï„Î¹ÎºÎ¬ ÎˆÎ¾Î¿Î´Î±'),
    ...
]

DISTRIBUTION_TYPES = [
    ('by_participation_mills', 'Î‘Î½Î¬ Î§Î¹Î»Î¹Î¿ÏƒÏ„Î¬'),
    ('equal_share', 'Î™ÏƒÏŒÏ€Î¿ÏƒÎ±'),
    ('specific_apartments', 'Î£Ï…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î±'),
    ('by_meters', 'ÎœÎµÏ„ÏÎ·Ï„Î­Ï‚')
]

PAYER_RESPONSIBILITY_CHOICES = [
    ('owner', 'Î™Î´Î¹Î¿ÎºÏ„Î®Ï„Î·Ï‚'),     # ÎˆÏÎ³Î±, Î±Ï€Î¿Î¸ÎµÎ¼Î±Ï„Î¹ÎºÏŒ
    ('resident', 'ÎˆÎ½Î¿Î¹ÎºÎ¿Ï‚'),      # Î¤Î±ÎºÏ„Î¹ÎºÎ¬ ÎºÎ¿Î¹Î½ÏŒÏ‡ÏÎ·ÏƒÏ„Î±
    ('shared', 'ÎšÎ¿Î¹Î½Î® Î•Ï…Î¸ÏÎ½Î·')
]
```

#### ÎœÎ­Î¸Î¿Î´Î¿Î¹:
```python
has_installments() â†’ bool
    # Î•Î»Î­Î³Ï‡ÎµÎ¹ Î±Î½ Î· Î´Î±Ï€Î¬Î½Î· Î­Ï‡ÎµÎ¹ Î´ÏŒÏƒÎµÎ¹Ï‚ Î¼Î­ÏƒÏ‰ scheduled_maintenance

get_linked_maintenance_projects() â†’ QuerySet
    # Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î± Î­ÏÎ³Î± ÏƒÏ…Î½Ï„Î®ÏÎ·ÏƒÎ·Ï‚ Î¼Îµ payment schedules

_create_apartment_transactions()
    # Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Transaction records Î³Î¹Î± ÏŒÎ»Î± Ï„Î± Î´Î¹Î±Î¼ÎµÏÎ¯ÏƒÎ¼Î±Ï„Î±
    # ÎšÎ±Î»ÎµÎ¯ _calculate_apartment_share() Î³Î¹Î± ÎºÎ¬Î¸Îµ Î´Î¹Î±Î¼Î­ÏÎ¹ÏƒÎ¼Î±

_calculate_apartment_share(apartment) â†’ Decimal
    # Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÎ¹ Ï„Î¿ Î¼ÎµÏÎ¯Î´Î¹Î¿ Î´Î¹Î±Î¼ÎµÏÎ¯ÏƒÎ¼Î±Ï„Î¿Ï‚ Î²Î¬ÏƒÎµÎ¹ distribution_type:
    # - equal_share: amount / total_apartments
    # - by_participation_mills: (amount Ã— apartment_mills) / total_mills
    # - by_meters: (amount Ã— apartment_meters) / total_meters
```

**Î‘Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ·:**
- Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ `Transaction` records Î³Î¹Î± Ï‡ÏÎµÏÏƒÎµÎ¹Ï‚ Î´Î¹Î±Î¼ÎµÏÎ¹ÏƒÎ¼Î¬Ï„Ï‰Î½
- Î£Ï…Î½Î´Î­ÎµÏ„Î±Î¹ Î¼Îµ `Building`, `Supplier`, `Project`
- Î•Î½Î·Î¼ÎµÏÏÎ½ÎµÎ¹ `apartment.current_balance` Î¼ÎµÏ„Î¬ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±
- Î ÏÎ¿ÏƒÎ¸Î­Ï„ÎµÎ¹ `TodoItem` Î±Î½ `add_to_calendar=True`

---

### 3. **Transaction** (Î£Ï…Î½Î±Î»Î»Î±Î³Î­Ï‚ Î¤Î±Î¼ÎµÎ¯Î¿Ï…)
**Î‘ÏÏ‡ÎµÎ¯Î¿:** `backend/financial/models.py:391-532`

#### Î ÎµÎ´Î¯Î± (ÎœÎµÏ„Î±Î²Î»Î·Ï„Î­Ï‚):
| Î ÎµÎ´Î¯Î¿ | Î¤ÏÏ€Î¿Ï‚ | Î£ÎºÎ¿Ï€ÏŒÏ‚ |
|-------|-------|--------|
| `building` | ForeignKey | ÎšÏ„Î¯ÏÎ¹Î¿ |
| `apartment` | ForeignKey | Î”Î¹Î±Î¼Î­ÏÎ¹ÏƒÎ¼Î± |
| `date` | DateTimeField | Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± ÏƒÏ…Î½Î±Î»Î»Î±Î³Î®Ï‚ |
| `type` | CharField | Î¤ÏÏ€Î¿Ï‚ (payment/expense/charge ÎºÏ„Î») |
| `status` | CharField | ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· (pending/completed/cancelled) |
| `description` | TextField | Î ÎµÏÎ¹Î³ÏÎ±Ï†Î® |
| `amount` | DecimalField | Î Î¿ÏƒÏŒ |
| `balance_before` | DecimalField | Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ Ï€ÏÎ¹Î½ |
| `balance_after` | DecimalField | Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ Î¼ÎµÏ„Î¬ |
| `reference_id`, `reference_type` | CharField | Î‘Î½Î±Ï†Î¿ÏÎ¬ ÏƒÎµ expense/payment |
| `receipt` | FileField | Î‘Ï€ÏŒÎ´ÎµÎ¹Î¾Î· |
| `notes` | TextField | Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚ |
| `created_by` | CharField | Î§ÏÎ®ÏƒÏ„Î·Ï‚ Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿ÏÏÎ³Î·ÏƒÎµ |

#### Î£Ï„Î±Î¸ÎµÏÎ­Ï‚ (Choices):
```python
TRANSACTION_TYPES = [
    ('common_expense_payment', 'Î•Î¯ÏƒÏ€ÏÎ±Î¾Î· ÎšÎ¿Î¹Î½Î¿Ï‡ÏÎ®ÏƒÏ„Ï‰Î½'),
    ('expense_payment', 'Î•Î¯ÏƒÏ€ÏÎ±Î¾Î· Î”Î±Ï€Î¬Î½Î·Ï‚'),
    ('refund', 'Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î®'),
    ('common_expense_charge', 'Î§ÏÎ­Ï‰ÏƒÎ· ÎšÎ¿Î¹Î½Î¿Ï‡ÏÎ®ÏƒÏ„Ï‰Î½'),
    ('payment_received', 'Î•Î¯ÏƒÏ€ÏÎ±Î¾Î· Î›Î·Ï†Î¸ÎµÎ¯ÏƒÎ±'),
    ('expense_created', 'Î”Î±Ï€Î¬Î½Î· Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ'),
    ('expense_issued', 'Î”Î±Ï€Î¬Î½Î· Î•ÎºÎ´ÏŒÎ¸Î·ÎºÎµ'),
    ('balance_adjustment', 'Î ÏÎ¿ÏƒÎ±ÏÎ¼Î¿Î³Î® Î¥Ï€Î¿Î»Î¿Î¯Ï€Î¿Ï…'),
    ('interest_charge', 'Î§ÏÎ­Ï‰ÏƒÎ· Î¤ÏŒÎºÏ‰Î½'),
    ('penalty_charge', 'Î§ÏÎ­Ï‰ÏƒÎ· Î ÏÎ¿ÏƒÏ„Î¯Î¼Î¿Ï…')
]

TRANSACTION_STATUS = [
    ('pending', 'Î•ÎºÎºÏÎµÎ¼ÎµÎ¯'),
    ('completed', 'ÎŸÎ»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ'),
    ('cancelled', 'Î‘ÎºÏ…ÏÏÎ¸Î·ÎºÎµ'),
    ('failed', 'Î‘Ï€Î­Ï„Ï…Ï‡Îµ')
]
```

#### ÎœÎ­Î¸Î¿Î´Î¿Î¹:
```python
save(*args, **kwargs)
    # Î•Î¾Î±ÏƒÏ†Î±Î»Î¯Î¶ÎµÎ¹ ÏŒÏ„Î¹ Ï„Î¿ date ÎµÎ¯Î½Î±Î¹ timezone-aware
    # Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î¿Ï‚ ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚ payer_responsibility Î²Î¬ÏƒÎµÎ¹ category
```

**Î‘Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ·:**
- ÎšÏÎ±Ï„Î¬ Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Î¿Î¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÏÎ½ ÎºÎ¹Î½Î®ÏƒÎµÏ‰Î½
- Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒ `apartment.current_balance`
- Î£Ï…Î½Î´Î­ÎµÏ„Î±Î¹ Î¼Îµ `Expense` ÎºÎ±Î¹ `Payment` Î¼Î­ÏƒÏ‰ `reference_id`

---

### 4. **Payment** (Î•Î¹ÏƒÏ€ÏÎ¬Î¾ÎµÎ¹Ï‚)
**Î‘ÏÏ‡ÎµÎ¯Î¿:** `backend/financial/models.py:534-614`

#### Î ÎµÎ´Î¯Î± (ÎœÎµÏ„Î±Î²Î»Î·Ï„Î­Ï‚):
| Î ÎµÎ´Î¯Î¿ | Î¤ÏÏ€Î¿Ï‚ | Î£ÎºÎ¿Ï€ÏŒÏ‚ |
|-------|-------|--------|
| `apartment` | ForeignKey | Î”Î¹Î±Î¼Î­ÏÎ¹ÏƒÎ¼Î± Ï€Î¿Ï… Î­ÎºÎ±Î½Îµ Ï„Î·Î½ Ï€Î»Î·ÏÏ‰Î¼Î® |
| `amount` | DecimalField | Î Î¿ÏƒÏŒ ÎºÎ¿Î¹Î½Î¿Ï‡ÏÎ®ÏƒÏ„Ï‰Î½ |
| `reserve_fund_amount` | DecimalField | Î Î¿ÏƒÏŒ Î±Ï€Î¿Î¸ÎµÎ¼Î±Ï„Î¹ÎºÎ¿Ï |
| `previous_obligations_amount` | DecimalField | Î Î±Î»Î±Î¹ÏŒÏ„ÎµÏÎµÏ‚ Î¿Ï†ÎµÎ¹Î»Î­Ï‚ |
| `date` | DateField | Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± ÎµÎ¯ÏƒÏ€ÏÎ±Î¾Î·Ï‚ |
| `method` | CharField | ÎœÎ­Î¸Î¿Î´Î¿Ï‚ Ï€Î»Î·ÏÏ‰Î¼Î®Ï‚ |
| `payment_type` | CharField | Î¤ÏÏ€Î¿Ï‚ Ï€Î»Î·ÏÏ‰Î¼Î®Ï‚ |
| `payer_type` | CharField | Î Î¿Î¹Î¿Ï‚ Ï€Î»Î·ÏÏÎ½ÎµÎ¹ (owner/tenant) |
| `payer_name` | CharField | ÎŒÎ½Î¿Î¼Î± Ï€Î»Î·ÏÏ‰Ï„Î® |
| `reference_number` | CharField | Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ Î±Î½Î±Ï†Î¿ÏÎ¬Ï‚ |
| `notes` | TextField | Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚ |
| `receipt` | FileField | Î‘Ï€ÏŒÎ´ÎµÎ¹Î¾Î· |

#### Î£Ï„Î±Î¸ÎµÏÎ­Ï‚ (Choices):
```python
PAYMENT_METHODS = [
    ('cash', 'ÎœÎµÏ„ÏÎ·Ï„Î¬'),
    ('bank_transfer', 'Î¤ÏÎ±Ï€ÎµÎ¶Î¹ÎºÎ® ÎœÎµÏ„Î±Ï†Î¿ÏÎ¬'),
    ('check', 'Î•Ï€Î¹Ï„Î±Î³Î®'),
    ('card', 'ÎšÎ¬ÏÏ„Î±')
]

PAYMENT_TYPES = [
    ('common_expense', 'ÎšÎ¿Î¹Î½ÏŒÏ‡ÏÎ·ÏƒÏ„Î±'),
    ('reserve_fund', 'Î¤Î±Î¼ÎµÎ¯Î¿ Î•Ï†ÎµÎ´ÏÎµÎ¯Î±Ï‚'),
    ('special_expense', 'Î•Î¹Î´Î¹ÎºÎ® Î”Î±Ï€Î¬Î½Î·'),
    ('advance', 'Î ÏÎ¿ÎºÎ±Ï„Î±Î²Î¿Î»Î®'),
    ('other', 'Î†Î»Î»Î¿')
]

PAYER_TYPES = [
    ('owner', 'Î™Î´Î¹Î¿ÎºÏ„Î®Ï„Î·Ï‚'),
    ('tenant', 'Î•Î½Î¿Î¹ÎºÎ¹Î±ÏƒÏ„Î®Ï‚'),
    ('other', 'Î†Î»Î»Î¿Ï‚')
]
```

#### ÎœÎ­Î¸Î¿Î´Î¿Î¹:
```python
save(*args, **kwargs)
    # Î‘Î½ ÎµÎ¯Î½Î±Î¹ Î½Î­Î± Ï€Î»Î·ÏÏ‰Î¼Î®, ÎºÎ±Î»ÎµÎ¯ _create_payment_transaction()

_create_payment_transaction()
    # Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Transaction record Ï„ÏÏ€Î¿Ï… 'payment_received'
    # Î•Î½Î·Î¼ÎµÏÏÎ½ÎµÎ¹ apartment.current_balance
    # Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÎ¹ balance_before ÎºÎ±Î¹ balance_after
```

**Î‘Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ·:**
- Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± `Transaction` Î¼ÎµÏ„Î¬ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±
- Î•Î½Î·Î¼ÎµÏÏÎ½ÎµÎ¹ `apartment.current_balance` (Ï€ÏÏŒÏƒÎ¸ÎµÏƒÎ· Ï€Î¯ÏƒÏ„Ï‰ÏƒÎ·Ï‚)
- Î£Ï…Î½Î´Î­ÎµÏ„Î±Î¹ Î¼Îµ `FinancialReceipt` Î³Î¹Î± Î±Ï€Î¿Î´ÎµÎ¯Î¾ÎµÎ¹Ï‚

---

### 5. **MeterReading** (ÎœÎµÏ„ÏÎ®ÏƒÎµÎ¹Ï‚)
**Î‘ÏÏ‡ÎµÎ¯Î¿:** `backend/financial/models.py:633-692`

#### Î ÎµÎ´Î¯Î± (ÎœÎµÏ„Î±Î²Î»Î·Ï„Î­Ï‚):
| Î ÎµÎ´Î¯Î¿ | Î¤ÏÏ€Î¿Ï‚ | Î£ÎºÎ¿Ï€ÏŒÏ‚ |
|-------|-------|--------|
| `apartment` | ForeignKey | Î”Î¹Î±Î¼Î­ÏÎ¹ÏƒÎ¼Î± |
| `reading_date` | DateField | Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î¼Î­Ï„ÏÎ·ÏƒÎ·Ï‚ |
| `value` | DecimalField | ÎˆÎ½Î´ÎµÎ¹Î¾Î· Î¼ÎµÏ„ÏÎ·Ï„Î® |
| `meter_type` | CharField | Î¤ÏÏ€Î¿Ï‚ (water/electricity/heating) |
| `notes` | TextField | Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚ |

#### Î£Ï„Î±Î¸ÎµÏÎ­Ï‚ (Choices):
```python
METER_TYPES = [
    ('water', 'ÎÎµÏÏŒ'),
    ('electricity', 'Î—Î»ÎµÎºÏ„ÏÎ¹ÎºÏŒ'),
    ('heating_hours', 'Î˜Î­ÏÎ¼Î±Î½ÏƒÎ· (ÎÏÎµÏ‚)'),
    ('heating_energy', 'Î˜Î­ÏÎ¼Î±Î½ÏƒÎ· (kWh/MWh)')
]
```

#### ÎœÎ­Î¸Î¿Î´Î¿Î¹:
```python
get_previous_reading() â†’ MeterReading
    # Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ Ï„Î·Î½ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î· Î¼Î­Ï„ÏÎ·ÏƒÎ· Ï„Î¿Ï… Î¯Î´Î¹Î¿Ï… Ï„ÏÏ€Î¿Ï…

calculate_consumption() â†’ float
    # Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÎ¹ ÎºÎ±Ï„Î±Î½Î¬Î»Ï‰ÏƒÎ·: current_value - previous_value

get_consumption_period() â†’ tuple[date, date]
    # Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ (start_date, end_date) Ï„Î·Ï‚ Ï€ÎµÏÎ¹ÏŒÎ´Î¿Ï… ÎºÎ±Ï„Î±Î½Î¬Î»Ï‰ÏƒÎ·Ï‚
```

**Î‘Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ·:**
- Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± ÎºÎ±Ï„Î±Î½Î¿Î¼Î® Î´Î±Ï€Î±Î½ÏÎ½ `by_meters`
- Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÎ¹ ÎºÎ±Ï„Î±Î½Î¬Î»Ï‰ÏƒÎ· Î±Î½Î¬ Î´Î¹Î±Î¼Î­ÏÎ¹ÏƒÎ¼Î±

---

### 6. **MonthlyBalance** (ÎœÎ·Î½Î¹Î±Î¯Î± Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î±)
**Î‘ÏÏ‡ÎµÎ¯Î¿:** `backend/financial/models.py:813-1021`

#### Î ÎµÎ´Î¯Î± (ÎœÎµÏ„Î±Î²Î»Î·Ï„Î­Ï‚):
| Î ÎµÎ´Î¯Î¿ | Î¤ÏÏ€Î¿Ï‚ | Î£ÎºÎ¿Ï€ÏŒÏ‚ |
|-------|-------|--------|
| `building` | ForeignKey | ÎšÏ„Î¯ÏÎ¹Î¿ |
| `year`, `month` | PositiveIntegerField | Î ÎµÏÎ¯Î¿Î´Î¿Ï‚ |
| `total_expenses` | DecimalField | Î£Ï…Î½Î¿Î»Î¹ÎºÎ­Ï‚ Î´Î±Ï€Î¬Î½ÎµÏ‚ Î¼Î®Î½Î± |
| `total_payments` | DecimalField | Î£Ï…Î½Î¿Î»Î¹ÎºÎ­Ï‚ ÎµÎ¹ÏƒÏ€ÏÎ¬Î¾ÎµÎ¹Ï‚ Î¼Î®Î½Î± |
| `previous_obligations` | DecimalField | Î Î±Î»Î¹Î­Ï‚ Î¿Ï†ÎµÎ¹Î»Î­Ï‚ Î±Ï€ÏŒ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿Ï…Ï‚ Î¼Î®Î½ÎµÏ‚ |
| `carry_forward` | DecimalField | Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ Ï€ÏÎ¿Ï‚ Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¬ (Î±ÏÎ½Î·Ï„Î¹ÎºÏŒ = Î¿Ï†ÎµÎ¹Î»Î®) |
| `reserve_fund_amount` | DecimalField | Î‘Ï€Î¿Î¸ÎµÎ¼Î±Ï„Î¹ÎºÏŒ |
| `management_fees` | DecimalField | ÎˆÎ¾Î¿Î´Î± Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚ |
| `annual_carry_forward` | DecimalField | Î•Ï„Î®ÏƒÎ¹Î± Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¬ (Î¼ÏŒÎ½Î¿ Î”ÎµÎºÎ­Î¼Î²ÏÎ¹Î¿Ï‚) |
| `balance_year` | PositiveIntegerField | ÎˆÏ„Î¿Ï‚ Ï…Ï€Î¿Î»Î¿Î¯Ï€Î¿Ï… |

#### Î¥Î²ÏÎ¹Î´Î¹ÎºÏŒ Î£ÏÏƒÏ„Î·Î¼Î± (ÎÎµÏ‡Ï‰ÏÎ¹ÏƒÏ„Î¬ Î¥Ï€Î¿Î»Î¿Î¯Ï€Î±):
```python
# ÎšÏÏÎ¹Î¿ Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿: ÎšÎ±Î½Î¿Î½Î¹ÎºÎ­Ï‚ Î”Î±Ï€Î¬Î½ÎµÏ‚ + Î Î±Î»Î±Î¹ÏŒÏ„ÎµÏÎµÏ‚ ÎŸÏ†ÎµÎ¹Î»Î­Ï‚
main_balance_carry_forward = DecimalField(default=0)

# Î‘Ï€Î¿Î¸ÎµÎ¼Î±Ï„Î¹ÎºÏŒ Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿: ÎœÏŒÎ½Î¿ Î³Î¹Î± Î±Ï€Î¿Ï„Î±Î¼Î¯ÎµÏ…ÏƒÎ·
reserve_balance_carry_forward = DecimalField(default=0)

# Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿: ÎˆÎ¾Î¿Î´Î± Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚
management_balance_carry_forward = DecimalField(default=0)
```

#### Î ÎµÎ´Î¯Î± ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚:
```python
is_closed = BooleanField(default=False)  # ÎšÎ»ÎµÎ¹ÏƒÏ„ÏŒÏ‚ Î¼Î®Î½Î±Ï‚
closed_at = DateTimeField(null=True)     # Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± ÎºÎ»ÎµÎ¹ÏƒÎ¯Î¼Î±Ï„Î¿Ï‚
```

#### ÎœÎ­Î¸Î¿Î´Î¿Î¹:
```python
month_display â†’ str
    # Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ "MM/YYYY"

total_obligations â†’ Decimal
    # Î£Ï…Î½Î¿Î»Î¹ÎºÎ­Ï‚ Ï…Ï€Î¿Ï‡ÏÎµÏÏƒÎµÎ¹Ï‚ = Î´Î±Ï€Î¬Î½ÎµÏ‚ + Ï€Î±Î»Î¹Î­Ï‚ Î¿Ï†ÎµÎ¹Î»Î­Ï‚ + Î±Ï€Î¿Î¸ÎµÎ¼Î±Ï„Î¹ÎºÏŒ + Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·

main_obligations â†’ Decimal
    # ÎšÏÏÎ¹ÎµÏ‚ Ï…Ï€Î¿Ï‡ÏÎµÏÏƒÎµÎ¹Ï‚ = ÎºÎ±Î½Î¿Î½Î¹ÎºÎ­Ï‚ Î´Î±Ï€Î¬Î½ÎµÏ‚ + Ï€Î±Î»Î±Î¹ÏŒÏ„ÎµÏÎµÏ‚ Î¿Ï†ÎµÎ¹Î»Î­Ï‚

reserve_obligations â†’ Decimal
    # Î‘Ï€Î¿Î¸ÎµÎ¼Î±Ï„Î¹ÎºÎ­Ï‚ Ï…Ï€Î¿Ï‡ÏÎµÏÏƒÎµÎ¹Ï‚ = Î¼ÏŒÎ½Î¿ Î±Ï€Î¿Î¸ÎµÎ¼Î±Ï„Î¹ÎºÏŒ

management_obligations â†’ Decimal
    # Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î¹ÎºÎ­Ï‚ Ï…Ï€Î¿Ï‡ÏÎµÏÏƒÎµÎ¹Ï‚ = Î¼ÏŒÎ½Î¿ Î­Î¾Î¿Î´Î± Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚

main_net_result â†’ Decimal
    # ÎšÏÏÎ¹Î¿ ÎºÎ±Î¸Î±ÏÏŒ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± = ÎµÎ¹ÏƒÏ€ÏÎ¬Î¾ÎµÎ¹Ï‚ - ÎºÏÏÎ¹ÎµÏ‚ Ï…Ï€Î¿Ï‡ÏÎµÏÏƒÎµÎ¹Ï‚

net_result â†’ Decimal
    # ÎšÎ±Î¸Î±ÏÏŒ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± = ÎµÎ¹ÏƒÏ€ÏÎ¬Î¾ÎµÎ¹Ï‚ - Ï…Ï€Î¿Ï‡ÏÎµÏÏƒÎµÎ¹Ï‚

close_month()
    # ÎšÎ»ÎµÎ¯Î½ÎµÎ¹ Ï„Î¿Î½ Î¼Î®Î½Î± ÎºÎ±Î¹ Ï…Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÎ¹ carry_forward
    # Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Ï„Î¿Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ Î¼Î®Î½Î± Î¼Îµ create_next_month()
    # Î¥Î²ÏÎ¹Î´Î¹ÎºÏŒ Î£ÏÏƒÏ„Î·Î¼Î±: Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÎ¹ Î¾ÎµÏ‡Ï‰ÏÎ¹ÏƒÏ„Î¬ carry_forward Î³Î¹Î±:
    #   - ÎšÏÏÎ¹Î¿ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿
    #   - Î‘Ï€Î¿Î¸ÎµÎ¼Î±Ï„Î¹ÎºÏŒ
    #   - Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·

create_next_month()
    # Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Ï„Î¿Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ Î¼Î®Î½Î± Î¼Îµ previous_obligations Î±Ï€ÏŒ carry_forward
    # Î£Ï…Î½ÎµÏ‡Î®Ï‚ Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¬: Î”ÎµÎºÎ­Î¼Î²ÏÎ¹Î¿Ï‚ â†’ Î™Î±Î½Î¿Ï…Î¬ÏÎ¹Î¿Ï‚ (Ï‡Ï‰ÏÎ¯Ï‚ Î¼Î·Î´ÎµÎ½Î¹ÏƒÎ¼ÏŒ)
    # ÎœÎ·Î½Î¹Î±Î¯Î± Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¬: Î â†’ Î+1
```

**Î‘Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ·:**
- ÎšÎ»ÎµÎ¯Î½ÎµÎ¹ Î¼Î·Î½Î¹Î±Î¯Î± Ï€ÎµÏÎ¯Î¿Î´Î¿ ÎºÎ±Î¹ Î¼ÎµÏ„Î±Ï†Î­ÏÎµÎ¹ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î±
- Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ `FinancialDashboardService` Î³Î¹Î± reports
- Î£Ï…Î½ÎµÏ‡Î®Ï‚ Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¬ Ï…Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½ (Î´ÎµÎ½ Î¼Î·Î´ÎµÎ½Î¯Î¶ÎµÏ„Î±Î¹ ÎºÎ¬Î¸Îµ Î­Ï„Î¿Ï‚)

---

### 7. **RecurringExpenseConfig** (Î•Ï€Î±Î½Î±Î»Î±Î¼Î²Î±Î½ÏŒÎ¼ÎµÎ½ÎµÏ‚ Î”Î±Ï€Î¬Î½ÎµÏ‚)
**Î‘ÏÏ‡ÎµÎ¯Î¿:** `backend/financial/models.py:1023-1218`

#### Î ÎµÎ´Î¯Î± (ÎœÎµÏ„Î±Î²Î»Î·Ï„Î­Ï‚):
| Î ÎµÎ´Î¯Î¿ | Î¤ÏÏ€Î¿Ï‚ | Î£ÎºÎ¿Ï€ÏŒÏ‚ |
|-------|-------|--------|
| `building` | ForeignKey | ÎšÏ„Î¯ÏÎ¹Î¿ |
| `expense_type` | CharField | management_fee / reserve_fund |
| `effective_from` | DateField | Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î­Î½Î±ÏÎ¾Î·Ï‚ Î¹ÏƒÏ‡ÏÎ¿Ï‚ |
| `effective_until` | DateField | Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î»Î®Î¾Î·Ï‚ (null = Î¹ÏƒÏ‡ÏÎµÎ¹) |
| `calculation_method` | CharField | ÎœÎ­Î¸Î¿Î´Î¿Ï‚ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Ï |
| `amount_per_apartment` | DecimalField | Î£Ï„Î±Î¸ÎµÏÏŒ Ï€Î¿ÏƒÏŒ/Î´Î¹Î±Î¼Î­ÏÎ¹ÏƒÎ¼Î± |
| `percentage` | DecimalField | Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎµÏ€Î¯ Î´Î±Ï€Î±Î½ÏÎ½ (%) |
| `total_amount` | DecimalField | Î£Ï„Î±Î¸ÎµÏÏŒ ÏƒÏ…Î½Î¿Î»Î¹ÎºÏŒ Ï€Î¿ÏƒÏŒ |
| `distribution_type` | CharField | Î¤ÏÏŒÏ€Î¿Ï‚ ÎºÎ±Ï„Î±Î½Î¿Î¼Î®Ï‚ |
| `is_active` | BooleanField | Î•Î½ÎµÏÎ³ÏŒ config |
| `notes` | TextField | Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚ |

#### Î£Ï„Î±Î¸ÎµÏÎ­Ï‚ (Choices):
```python
EXPENSE_TYPE_CHOICES = [
    ('management_fee', 'Î”Î±Ï€Î¬Î½ÎµÏ‚ Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚'),
    ('reserve_fund', 'Î‘Ï€Î¿Î¸ÎµÎ¼Î±Ï„Î¹ÎºÏŒ Î¤Î±Î¼ÎµÎ¯Î¿')
]

CALCULATION_METHOD_CHOICES = [
    ('fixed_per_apartment', 'Î£Ï„Î±Î¸ÎµÏÏŒ Î Î¿ÏƒÏŒ Î±Î½Î¬ Î”Î¹Î±Î¼Î­ÏÎ¹ÏƒÎ¼Î±'),
    ('percentage_of_expenses', 'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎµÏ€Î¯ Î”Î±Ï€Î±Î½ÏÎ½'),
    ('fixed_total', 'Î£Ï„Î±Î¸ÎµÏÏŒ Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ Î Î¿ÏƒÏŒ')
]
```

#### ÎœÎ­Î¸Î¿Î´Î¿Î¹:
```python
get_amount_display() â†’ str
    # Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ human-readable string: "â‚¬12/Î´Î¹Î±Î¼Î­ÏÎ¹ÏƒÎ¼Î±", "5% ÎµÏ€Î¯ Î´Î±Ï€Î±Î½ÏÎ½"

calculate_total_amount(month_expenses: Decimal) â†’ Decimal
    # Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÎ¹ Ï„Î¿ ÏƒÏ…Î½Î¿Î»Î¹ÎºÏŒ Ï€Î¿ÏƒÏŒ Ï„Î·Ï‚ Î´Î±Ï€Î¬Î½Î·Ï‚ Î³Î¹Î± Ï„Î¿Î½ Î¼Î®Î½Î±:
    # - fixed_per_apartment: amount_per_apartment Ã— num_apartments
    # - percentage_of_expenses: month_expenses Ã— (percentage / 100)
    # - fixed_total: total_amount

@staticmethod
get_active_config(building_id, expense_type, target_date) â†’ RecurringExpenseConfig
    # Î’ÏÎ¯ÏƒÎºÎµÎ¹ Ï„Î·Î½ ÎµÎ½ÎµÏÎ³Î® ÏÏÎ¸Î¼Î¹ÏƒÎ· Î³Î¹Î± ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±
    # Î¦Î¹Î»Ï„ÏÎ¬ÏÎµÎ¹: effective_from â‰¤ target_date â‰¤ effective_until
```

**Î‘Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ·:**
- Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ `CommonExpenseAutomationService` Î³Î¹Î± Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î´Î±Ï€Î±Î½ÏÎ½
- ÎšÏÎ±Ï„Î¬ Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ Î±Î»Î»Î±Î³ÏÎ½ (Ï€.Ï‡. "Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· â‚¬12/Î¼Î®Î½Î± Î±Ï€ÏŒ 01/01/2025, â‚¬15/Î¼Î®Î½Î± Î±Ï€ÏŒ 01/06/2025")

---

## âš™ï¸ Î¥Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏÎ½

### 1. **BalanceCalculationService** (ÎšÎµÎ½Ï„ÏÎ¹ÎºÎ® Î¥Ï€Î·ÏÎµÏƒÎ¯Î± Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Ï Î¥Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½)
**Î‘ÏÏ‡ÎµÎ¯Î¿:** `backend/financial/balance_service.py:29-324`

**Î£ÎºÎ¿Ï€ÏŒÏ‚:** Single Source of Truth Î³Î¹Î± ÎŸÎ›ÎŸÎ¥Î£ Ï„Î¿Ï…Ï‚ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿ÏÏ‚ Ï…Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½

#### ÎœÎ­Î¸Î¿Î´Î¿Î¹:
```python
@staticmethod
calculate_historical_balance(apartment, end_date, include_management_fees=True) â†’ Decimal
    # Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÎ¿Ï Ï…Ï€Î¿Î»Î¿Î¯Ï€Î¿Ï… Î¼Î­Ï‡ÏÎ¹ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±
    #
    # Î›Î¿Î³Î¹ÎºÎ®:
    # 1. Î’ÏÎ¯ÏƒÎºÎµÎ¹ Î´Î±Ï€Î¬Î½ÎµÏ‚ Î Î¡Î™Î Î±Ï€ÏŒ month_start (date__lt, ÏŒÏ‡Î¹ date__lte)
    # 2. Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÎ¹ Ï‡ÏÎµÏÏƒÎµÎ¹Ï‚ Î±Ï€ÏŒ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ Î´Î±Ï€Î¬Î½ÎµÏ‚ (ÎµÎºÏ„ÏŒÏ‚ management_fees)
    # 3. Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÎ¹ Ï€Î»Î·ÏÏ‰Î¼Î­Ï‚ Î¼Î­Ï‡ÏÎ¹ end_date
    # 4. Î‘Î½ include_management_fees=True, Ï€ÏÎ¿ÏƒÎ¸Î­Ï„ÎµÎ¹ management fee charges
    # 5. balance = (total_charges + management_charges) - total_payments
    #
    # ÎšÎ¡Î™Î£Î™ÎœÎŸ: Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ date__lt (ÏŒÏ‡Î¹ date__lte) Î³Î¹Î± Î±Ï€Î¿Ï†Ï…Î³Î® Î´Î¹Ï€Î»Î®Ï‚ Ï‡ÏÎ­Ï‰ÏƒÎ·Ï‚!
    # Î˜ÎµÏ„Î¹ÎºÏŒ balance = Î§ÏÎ­Î¿Ï‚, Î‘ÏÎ½Î·Ï„Î¹ÎºÏŒ = Î Î¯ÏƒÏ„Ï‰ÏƒÎ·

@staticmethod
calculate_current_balance(apartment) â†’ Decimal
    # Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Ï„ÏÎ­Ï‡Î¿Î½Ï„Î¿Ï‚ Ï…Ï€Î¿Î»Î¿Î¯Ï€Î¿Ï… Î±Ï€ÏŒ ÎŸÎ›Î‘ Ï„Î± transactions
    #
    # Î›Î¿Î³Î¹ÎºÎ®:
    # 1. Î Î±Î¯ÏÎ½ÎµÎ¹ ÏŒÎ»Î± Ï„Î± transactions Ï„Î±Î¾Î¹Î½Î¿Î¼Î·Î¼Î­Î½Î± Ï‡ÏÎ¿Î½Î¿Î»Î¿Î³Î¹ÎºÎ¬
    # 2. Running balance = 0
    # 3. Î“Î¹Î± ÎºÎ¬Î¸Îµ transaction:
    #    - Payments: running_balance -= amount (Î¼ÎµÎ¯Ï‰ÏƒÎ· Ï‡ÏÎ­Î¿Ï…Ï‚)
    #    - Charges: running_balance += amount (Î±ÏÎ¾Î·ÏƒÎ· Ï‡ÏÎ­Î¿Ï…Ï‚)
    #    - Adjustments: running_balance = balance_after
    # 4. Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ Ï„ÎµÎ»Î¹ÎºÏŒ running_balance

@staticmethod
update_apartment_balance(apartment) â†’ Decimal
    # Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… apartment.current_balance Î¼Îµ Ï„Î¿ ÏƒÏ‰ÏƒÏ„ÏŒ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿
    #
    # Î›Î¿Î³Î¹ÎºÎ®:
    # 1. Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÎ¹ Ï„Î¿ Î½Î­Î¿ balance Î¼Îµ calculate_current_balance()
    # 2. Î‘Ï€Î¿Î¸Î·ÎºÎµÏÎµÎ¹ Ï„Î¿ ÏƒÏ„Î¿ apartment.current_balance
    # 3. ÎšÎ±Ï„Î±Î³ÏÎ¬Ï†ÎµÎ¹ performance logging
    # 4. Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ Ï„Î¿ Î½Î­Î¿ balance
    #
    # Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ:
    # - Signals (post_save/post_delete)
    # - Recalculation scripts

@staticmethod
verify_balance_consistency(apartment) â†’ dict
    # Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ· ÏŒÏ„Î¹ stored balance = calculated balance
    #
    # Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹:
    # {
    #   'apartment_number': str,
    #   'stored_balance': Decimal,
    #   'calculated_balance': Decimal,
    #   'difference': Decimal,
    #   'is_consistent': bool (difference < 0.01â‚¬)
    # }
```

**Î‘Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ·:**
- **Î‘Î½Ï„Î¹ÎºÎ±Î¸Î¹ÏƒÏ„Î¬:**
  - `CommonExpenseCalculator._get_historical_balance()`
  - `CommonExpenseDistributor._get_historical_balance()`
  - `BalanceTransferService._calculate_historical_balance()`
  - `_calculate_apartment_balance()`
- **Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ:**
  - `CommonExpenseCalculator` (balance transfers)
  - `FinancialDashboardService` (reports)
  - Signals (Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î· ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·)

---

### 2. **BalanceIntegrityService** (Î”Î¹Î±ÏƒÏ†Î¬Î»Î¹ÏƒÎ· Î‘ÎºÎµÏÎ±Î¹ÏŒÏ„Î·Ï„Î±Ï‚)
**Î‘ÏÏ‡ÎµÎ¯Î¿:** `backend/financial/services/balance_integrity_service.py:27-433`

#### ÎœÎ­Î¸Î¿Î´Î¿Î¹:
```python
__init__(building_id)
    # Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Î¼Îµ building_id

validate_all_balances() â†’ dict
    # Î•Ï€Î±Î»Î·Î¸ÎµÏÎµÎ¹ ÏŒÎ»Î± Ï„Î± Ï…Ï€Î¿Î»Î¿Î¯Ï€Î± Ï„Î¿Ï… ÎºÏ„Î¹ÏÎ¯Î¿Ï…
    #
    # Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹:
    # {
    #   'total_apartments': int,
    #   'errors_found': int,
    #   'duplicate_transactions': list,
    #   'apartment_results': list[dict]
    # }

validate_apartment_balance(apartment) â†’ dict
    # Î•Ï€Î±Î»Î·Î¸ÎµÏÎµÎ¹ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ ÎµÎ½ÏŒÏ‚ Î´Î¹Î±Î¼ÎµÏÎ¯ÏƒÎ¼Î±Ï„Î¿Ï‚
    #
    # Î•Î»Î­Î³Ï‡ÎµÎ¹:
    # 1. current_balance vs calculated_balance (tolerance: 0.01â‚¬)
    # 2. Î”Î¹Ï€Î»Î­Ï‚ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ®ÏƒÎµÎ¹Ï‚ (Î¯Î´Î¹Î¿ Ï€Î¿ÏƒÏŒ, Ï„ÏÏ€Î¿Ï‚, Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±)
    # 3. Suspicious transactions (Î¼Î·Î´ÎµÎ½Î¹ÎºÏŒ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ Î¼ÎµÏ„Î¬ Ï€Î»Î·ÏÏ‰Î¼Î®Ï‚)

_calculate_balance_from_transactions(apartment) â†’ Decimal
    # Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÎ¹ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ Î±Ï€ÏŒ Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ transactions
    #
    # Î›Î¿Î³Î¹ÎºÎ®:
    # - Payments/refunds: balance += amount
    # - Charges/expenses: balance -= amount

_detect_suspicious_transactions(apartment) â†’ list[dict]
    # Î‘Î½Î¹Ï‡Î½ÎµÏÎµÎ¹ Ï€Î±ÏÎ¬Î¾ÎµÎ½ÎµÏ‚ ÏƒÏ…Î½Î±Î»Î»Î±Î³Î­Ï‚:
    # - Î”Î¹Ï€Î»Î­Ï‚ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ®ÏƒÎµÎ¹Ï‚ Ï„Î·Î½ Î¯Î´Î¹Î± Î·Î¼Î­ÏÎ±
    # - Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ â‰  0 Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ Ï€Î»Î·ÏÏ‰Î¼Î®

detect_duplicate_transactions() â†’ list[dict]
    # Î‘Î½Î¹Ï‡Î½ÎµÏÎµÎ¹ Î´Î¹Ï€Î»Î­Ï‚ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ®ÏƒÎµÎ¹Ï‚ ÏƒÎµ ÏŒÎ»Î¿ Ï„Î¿ ÎºÏ„Î¯ÏÎ¹Î¿

fix_apartment_balance(apartment, force_correction=False) â†’ dict
    # Î”Î¹Î¿ÏÎ¸ÏÎ½ÎµÎ¹ Ï„Î¿ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ ÎµÎ½ÏŒÏ‚ Î´Î¹Î±Î¼ÎµÏÎ¯ÏƒÎ¼Î±Ï„Î¿Ï‚
    #
    # Î›Î¿Î³Î¹ÎºÎ®:
    # 1. Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÎ¹ correct_balance
    # 2. Î‘Î½ difference > 0.01â‚¬, ÎµÎ½Î·Î¼ÎµÏÏÎ½ÎµÎ¹ apartment.current_balance

fix_all_balances(force_correction=False) â†’ dict
    # Î”Î¹Î¿ÏÎ¸ÏÎ½ÎµÎ¹ ÏŒÎ»Î± Ï„Î± Ï…Ï€Î¿Î»Î¿Î¯Ï€Î± Ï„Î¿Ï… ÎºÏ„Î¹ÏÎ¯Î¿Ï…

remove_duplicate_transactions(duplicates) â†’ dict
    # Î‘Ï†Î±Î¹ÏÎµÎ¯ Î´Î¹Ï€Î»Î­Ï‚ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ®ÏƒÎµÎ¹Ï‚

generate_integrity_report() â†’ str
    # Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ markdown Î±Î½Î±Ï†Î¿ÏÎ¬ Î±ÎºÎµÏÎ±Î¹ÏŒÏ„Î·Ï„Î±Ï‚

send_integrity_alert(results, admin_email)
    # Î£Ï„Î­Î»Î½ÎµÎ¹ email ÎµÎ¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î³Î¹Î± Ï€ÏÎ¿Î²Î»Î®Î¼Î±Ï„Î±
```

**Î‘Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ·:**
- Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ `BalanceCalculationService` Î³Î¹Î± Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿ÏÏ‚
- Î¤ÏÎ­Ï‡ÎµÎ¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Î±Ï€ÏŒ `BalanceMaintenanceService` (daily/weekly)
- Î£Ï„Î­Î»Î½ÎµÎ¹ email alerts ÏŒÏ„Î±Î½ Î²ÏÎ¯ÏƒÎºÎµÎ¹ Ï€ÏÎ¿Î²Î»Î®Î¼Î±Ï„Î±

---

### 3. **BalanceMaintenanceService** (Î ÏÎ¿Î»Î·Ï€Ï„Î¹ÎºÎ® Î£Ï…Î½Ï„Î®ÏÎ·ÏƒÎ·)
**Î‘ÏÏ‡ÎµÎ¯Î¿:** `backend/financial/services/balance_integrity_service.py:435-478`

#### ÎœÎ­Î¸Î¿Î´Î¿Î¹:
```python
@staticmethod
run_daily_validation()
    # Î¤ÏÎ­Ï‡ÎµÎ¹ ÎºÎ±Î¸Î·Î¼ÎµÏÎ¹Î½Î® ÎµÏ€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ· ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ ÎºÏ„Î¹ÏÎ¯Ï‰Î½
    # Î£Ï„Î­Î»Î½ÎµÎ¹ alerts Î±Î½ Î²ÏÎµÎ¸Î¿ÏÎ½ ÏƒÏ†Î¬Î»Î¼Î±Ï„Î±

@staticmethod
run_weekly_cleanup()
    # Î¤ÏÎ­Ï‡ÎµÎ¹ ÎµÎ²Î´Î¿Î¼Î±Î´Î¹Î±Î¯Î± ÎºÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒ:
    # 1. Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ· (validate_all_balances)
    # 2. Î”Î¹ÏŒÏÎ¸Ï‰ÏƒÎ· Ï…Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½ (fix_all_balances)
    # 3. Î‘Ï†Î±Î¯ÏÎµÏƒÎ· Î´Î¹Ï€Î»ÏÎ½ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ®ÏƒÎµÏ‰Î½
```

**Î‘Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ·:**
- ÎšÎ±Î»ÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ Django management commands Î® cron jobs
- Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ `BalanceIntegrityService` Î³Î¹Î± checks & fixes

---

### 4. **CommonExpenseCalculator** (Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÎšÎ¿Î¹Î½Î¿Ï‡ÏÎ®ÏƒÏ„Ï‰Î½)
**Î‘ÏÏ‡ÎµÎ¯Î¿:** `backend/financial/services.py`

#### ÎœÎ­Î¸Î¿Î´Î¿Î¹:
```python
__init__(building_id, month=None, year=None)
    # Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Î¼Îµ building_id ÎºÎ±Î¹ Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ® Ï€ÎµÏÎ¯Î¿Î´Î¿

calculate_shares() â†’ dict
    # Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÎ¹ ÎºÎ¿Î¹Î½ÏŒÏ‡ÏÎ·ÏƒÏ„Î± Î³Î¹Î± ÏŒÎ»Î± Ï„Î± Î´Î¹Î±Î¼ÎµÏÎ¯ÏƒÎ¼Î±Ï„Î±
    #
    # Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹:
    # {
    #   apartment_id: {
    #     'apartment_number': str,
    #     'owner_name': str,
    #     'participation_mills': int,
    #     'total_amount': Decimal,
    #     'previous_balance': Decimal,
    #     'breakdown': {
    #       'regular_expenses': Decimal,
    #       'elevator': Decimal,
    #       'heating': Decimal,
    #       ...
    #     }
    #   }
    # }
    #
    # Î›Î¿Î³Î¹ÎºÎ®:
    # 1. Î Î±Î¯ÏÎ½ÎµÎ¹ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î´Î±Ï€Î¬Î½ÎµÏ‚ Ï„Î¿Ï… Î¼Î®Î½Î±
    # 2. Î“Î¹Î± ÎºÎ¬Î¸Îµ Î´Î±Ï€Î¬Î½Î·, Ï…Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÎ¹ Î¼ÎµÏÎ¯Î´Î¹Î¿ Î±Î½Î¬ Î´Î¹Î±Î¼Î­ÏÎ¹ÏƒÎ¼Î± (Î²Î¬ÏƒÎµÎ¹ distribution_type)
    # 3. Î‘Î¸ÏÎ¿Î¯Î¶ÎµÎ¹ Î±Î½Î¬ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±
    # 4. Î ÏÎ¿ÏƒÎ¸Î­Ï„ÎµÎ¹ previous_balance Î±Ï€ÏŒ BalanceCalculationService

_calculate_apartment_share(expense, apartment) â†’ Decimal
    # Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÎ¹ Î¼ÎµÏÎ¯Î´Î¹Î¿ Î´Î¹Î±Î¼ÎµÏÎ¯ÏƒÎ¼Î±Ï„Î¿Ï‚ Î³Î¹Î± Î´Î±Ï€Î¬Î½Î·
    # ÎšÎ±Î»ÎµÎ¯ Expense._calculate_apartment_share()
```

**Î‘Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ·:**
- Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ `BalanceCalculationService.calculate_historical_balance()` Î³Î¹Î± previous balances
- Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ `ExpenseViewSet` Î³Î¹Î± Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î· Ï‡ÏÎ­Ï‰ÏƒÎ·
- Î Î±ÏÎ¬Î³ÎµÎ¹ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î³Î¹Î± PDF common expense sheets

---

### 5. **PaymentProcessor** (Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Î Î»Î·ÏÏ‰Î¼ÏÎ½)
**Î‘ÏÏ‡ÎµÎ¯Î¿:** `backend/financial/services.py`

#### ÎœÎ­Î¸Î¿Î´Î¿Î¹:
```python
process_payment(payment_data) â†’ Payment
    # Î•Ï€ÎµÎ¾ÎµÏÎ³Î¬Î¶ÎµÏ„Î±Î¹ Î½Î­Î± Ï€Î»Î·ÏÏ‰Î¼Î®
    #
    # Î›Î¿Î³Î¹ÎºÎ®:
    # 1. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Payment record
    # 2. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Transaction record (Î¼Î­ÏƒÏ‰ Payment.save())
    # 3. Î•Î½Î·Î¼ÎµÏÏÎ½ÎµÎ¹ apartment.current_balance
    # 4. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ FinancialReceipt Î±Î½ Î¶Î·Ï„Î·Î¸ÎµÎ¯

refund_payment(payment_id, reason) â†’ Transaction
    # Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® Ï€Î»Î·ÏÏ‰Î¼Î®Ï‚
    #
    # Î›Î¿Î³Î¹ÎºÎ®:
    # 1. Î’ÏÎ¯ÏƒÎºÎµÎ¹ Ï„Î¿ Payment
    # 2. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Transaction Ï„ÏÏ€Î¿Ï… 'refund'
    # 3. Î•Î½Î·Î¼ÎµÏÏÎ½ÎµÎ¹ apartment.current_balance (Î±Ï†Î±Î¯ÏÎµÏƒÎ· Ï€Î¯ÏƒÏ„Ï‰ÏƒÎ·Ï‚)
```

**Î‘Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ·:**
- Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ `Transaction` records
- Î•Î½Î·Î¼ÎµÏÏÎ½ÎµÎ¹ `apartment.current_balance`
- Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ `FinancialReceipt` Î³Î¹Î± Î±Ï€Î¿Î´ÎµÎ¯Î¾ÎµÎ¹Ï‚

---

### 6. **FinancialDashboardService** (ÎŸÎ¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÎ® Î•Ï€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ·)
**Î‘ÏÏ‡ÎµÎ¯Î¿:** `backend/financial/services.py`

#### ÎœÎ­Î¸Î¿Î´Î¿Î¹:
```python
get_building_summary(building_id, month, year) â†’ dict
    # Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ Ï€ÎµÏÎ¯Î»Î·ÏˆÎ· Î¿Î¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÏÎ½ ÎºÏ„Î¹ÏÎ¯Î¿Ï…
    #
    # Î ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹:
    # {
    #   'total_expenses': Decimal,
    #   'total_payments': Decimal,
    #   'total_balance': Decimal,
    #   'apartments_in_debt': int,
    #   'apartments_with_credit': int,
    #   'average_debt': Decimal,
    #   'total_reserve_fund': Decimal,
    #   'monthly_balance': MonthlyBalance
    # }

get_apartment_financial_history(apartment_id, start_date, end_date) â†’ list
    # Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ ÏƒÏ…Î½Î±Î»Î»Î±Î³ÏÎ½ Î´Î¹Î±Î¼ÎµÏÎ¯ÏƒÎ¼Î±Ï„Î¿Ï‚
    #
    # Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹:
    # [
    #   {
    #     'date': datetime,
    #     'type': str,
    #     'description': str,
    #     'amount': Decimal,
    #     'balance': Decimal
    #   }
    # ]

generate_financial_report(building_id, period) â†’ dict
    # Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Î¿Î¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÎ® Î±Î½Î±Ï†Î¿ÏÎ¬
    #
    # Î ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹:
    # - ÎˆÏƒÎ¿Î´Î±/ÎˆÎ¾Î¿Î´Î± Î±Î½Î¬ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±
    # - ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Ï…Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½
    # - Î ÏÎ¿Î²Î»Î­ÏˆÎµÎ¹Ï‚
    # - GraÏ†Î®Î¼Î±Ï„Î±
```

**Î‘Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ·:**
- Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ `BalanceCalculationService` Î³Î¹Î± Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿ÏÏ‚
- Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ `MonthlyBalance` Î³Î¹Î± Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÎ¬ Î´ÎµÎ´Î¿Î¼Î­Î½Î±
- Î Î±ÏÎ¬Î³ÎµÎ¹ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î³Î¹Î± frontend dashboards

---

## ğŸ”Œ API Views & Serializers

### 1. **ExpenseViewSet**
**Î‘ÏÏ‡ÎµÎ¯Î¿:** `backend/financial/views.py:131-267`

#### Actions:
```python
list(request) â†’ Response
    # Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ Î»Î¯ÏƒÏ„Î± Î´Î±Ï€Î±Î½ÏÎ½ Î¼Îµ Ï†Î¯Î»Ï„ÏÎ±
    # Î¦Î¯Î»Ï„ÏÎ±: building, category, date__gte, date__lte, category__not_in

create(request) â†’ Response
    # Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Î½Î­Î± Î´Î±Ï€Î¬Î½Î·
    #
    # Î›Î¿Î³Î¹ÎºÎ®:
    # 1. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Expense
    # 2. Î•Î½Î·Î¼ÎµÏÏÎ½ÎµÎ¹ building.current_reserve
    # 3. Î§ÎµÎ¹ÏÎ¹ÏƒÎ¼ÏŒÏ‚ file upload (attachment)
    # 4. Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏƒÏ„Î¿ Î·Î¼ÎµÏÎ¿Î»ÏŒÎ³Î¹Î¿ (TodoItem) Î±Î½ add_to_calendar=True
    # 5. Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Ï‡ÏÎ­Ï‰ÏƒÎ· Î´Î¹Î±Î¼ÎµÏÎ¹ÏƒÎ¼Î¬Ï„Ï‰Î½ (CommonExpenseCalculator)
    # 6. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Transaction records
    # 7. Auto cleanup (DataIntegrityService)

update(request, pk) â†’ Response
    # Î•Î½Î·Î¼ÎµÏÏÎ½ÎµÎ¹ Î´Î±Ï€Î¬Î½Î·
    # Î•Î½Î·Î¼ÎµÏÏÎ½ÎµÎ¹ building.current_reserve (difference)

destroy(request, pk) â†’ Response
    # Î”Î¹Î±Î³ÏÎ¬Ï†ÎµÎ¹ Î´Î±Ï€Î¬Î½Î·
    # Î‘Ï€Î¿ÏƒÏ…Î½Î´Î­ÎµÎ¹ Î±Ï€ÏŒ scheduled_maintenance
    # Î•Ï€Î±Î½Î±Ï…Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÎ¹ balances
```

#### Î¦Î¯Î»Ï„ÏÎ± (ExpenseFilter):
```python
building = IntegerField()
category = CharField()
date__gte = DateFilter()
date__lte = DateFilter()
category__not_in = CharField()  # Comma-separated categories to exclude
```

**Î‘Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ·:**
- ÎšÎ±Î»ÎµÎ¯ `CommonExpenseCalculator` Î³Î¹Î± Ï‡ÏÎµÏÏƒÎµÎ¹Ï‚
- Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ `TodoItem` Î³Î¹Î± Î·Î¼ÎµÏÎ¿Î»ÏŒÎ³Î¹Î¿
- Î•Î½Î·Î¼ÎµÏÏÎ½ÎµÎ¹ `building.current_reserve`
- Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ `Transaction` records

---

### 2. **PaymentViewSet**
**Î‘ÏÏ‡ÎµÎ¯Î¿:** `backend/financial/views.py`

#### Actions:
```python
list(request) â†’ Response
    # Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ Î»Î¯ÏƒÏ„Î± Ï€Î»Î·ÏÏ‰Î¼ÏÎ½ Î¼Îµ Ï†Î¯Î»Ï„ÏÎ±
    # Î¦Î¯Î»Ï„ÏÎ±: apartment, building, date__gte, date__lte

create(request) â†’ Response
    # Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Î½Î­Î± Ï€Î»Î·ÏÏ‰Î¼Î®
    #
    # Î›Î¿Î³Î¹ÎºÎ®:
    # 1. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Payment
    # 2. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Transaction (Î¼Î­ÏƒÏ‰ Payment.save())
    # 3. Î•Î½Î·Î¼ÎµÏÏÎ½ÎµÎ¹ apartment.current_balance

retrieve(request, pk) â†’ Response
    # Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ Î»ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ Ï€Î»Î·ÏÏ‰Î¼Î®Ï‚

update(request, pk) â†’ Response
    # Î•Î½Î·Î¼ÎµÏÏÎ½ÎµÎ¹ Ï€Î»Î·ÏÏ‰Î¼Î®

destroy(request, pk) â†’ Response
    # Î”Î¹Î±Î³ÏÎ¬Ï†ÎµÎ¹ Ï€Î»Î·ÏÏ‰Î¼Î®
    # Î•Ï€Î±Î½Î±Ï…Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÎ¹ balance
```

**Î‘Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ·:**
- Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ `Transaction` Î¼Î­ÏƒÏ‰ `Payment.save()`
- Î•Î½Î·Î¼ÎµÏÏÎ½ÎµÎ¹ `apartment.current_balance`

---

### 3. **TransactionViewSet**
**Î‘ÏÏ‡ÎµÎ¯Î¿:** `backend/financial/views.py`

#### Actions:
```python
list(request) â†’ Response
    # Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ Î»Î¯ÏƒÏ„Î± ÏƒÏ…Î½Î±Î»Î»Î±Î³ÏÎ½ Î¼Îµ Ï†Î¯Î»Ï„ÏÎ±
    # Î¦Î¯Î»Ï„ÏÎ±: building, apartment, type, date__gte, date__lte

retrieve(request, pk) â†’ Response
    # Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ Î»ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ ÏƒÏ…Î½Î±Î»Î»Î±Î³Î®Ï‚
```

**Î‘Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ·:**
- Read-only (Î´ÎµÎ½ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ create/update/delete)
- Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ ÎºÎ±Î¹ auditing

---

### 4. **Serializers**

#### ExpenseSerializer
**Î‘ÏÏ‡ÎµÎ¯Î¿:** `backend/financial/serializers.py:22-169`

```python
# Read-only Fields:
category_display â†’ str  # Human-readable category
supplier_name â†’ str
attachment_url â†’ str  # Absolute URL
project_title, project_url â†’ str  # Project integration
has_installments â†’ bool
linked_maintenance_projects â†’ list[dict]

# Validation:
validate_amount(value)
    # Î•Î»Î­Î³Ï‡ÎµÎ¹ ÏŒÏ„Î¹ amount > 0

validate_attachment(value)
    # Î•Ï€Î¹Î²ÎµÎ²Î±Î¹ÏÎ½ÎµÎ¹ file Î¼Îµ FileUploadService
```

#### PaymentSerializer
**Î‘ÏÏ‡ÎµÎ¯Î¿:** `backend/financial/serializers.py:199-305`

```python
# Computed Fields:
current_balance â†’ float
    # Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÎ¹ balance Î±Ï€ÏŒ transactions (Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ logic Î±Ï€ÏŒ BalanceCalculationService)

monthly_due â†’ float
    # Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÎ¹ Î¼Î·Î½Î¹Î±Î¯Î± Î¿Ï†ÎµÎ¹Î»Î® (ÎºÎ¿Î¹Î½ÏŒÏ‡ÏÎ·ÏƒÏ„Î± + Î±Ï€Î¿Î¸ÎµÎ¼Î±Ï„Î¹ÎºÏŒ)
```

#### TransactionSerializer
**Î‘ÏÏ‡ÎµÎ¯Î¿:** `backend/financial/serializers.py:171-196`

```python
# Read-only Fields:
type_display â†’ str
status_display â†’ str
receipt_url â†’ str
```

---

## ğŸ”„ Î‘Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ· Î£Ï…ÏƒÏ„Î·Î¼Î¬Ï„Ï‰Î½

### Î¡Î¿Î® Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚ Î”Î±Ï€Î¬Î½Î·Ï‚

```
User â†’ ExpenseViewSet.create()
  â†“
1. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Expense record
  â†“
2. Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· building.current_reserve
  â†“
3. File upload (Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ attachment)
  â†“
4. Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· TodoItem (Î±Î½ add_to_calendar=True)
  â†“
5. CommonExpenseCalculator.calculate_shares()
  â†“
6. Î“Î¹Î± ÎºÎ¬Î¸Îµ Î´Î¹Î±Î¼Î­ÏÎ¹ÏƒÎ¼Î±:
   - Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Transaction record
   - Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· apartment.current_balance
  â†“
7. FinancialAuditLog.log_expense_action()
  â†“
8. DataIntegrityService.auto_cleanup_and_refresh()
```

---

### Î¡Î¿Î® ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·Ï‚ Î Î»Î·ÏÏ‰Î¼Î®Ï‚

```
User â†’ PaymentViewSet.create()
  â†“
1. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Payment record
  â†“
2. Payment.save() trigger
  â†“
3. Payment._create_payment_transaction()
   - Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Transaction record (type='payment_received')
   - Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ balance_before ÎºÎ±Î¹ balance_after
  â†“
4. Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· apartment.current_balance
  â†“
5. FinancialReceipt (Î±Î½ Î¶Î·Ï„Î·Î¸ÎµÎ¯)
```

---

### Î¡Î¿Î® Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Ï Î¥Ï€Î¿Î»Î¿Î¯Ï€Î¿Ï…

```
Î‘Î½Î¬Î³ÎºÎ· Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Ï balance
  â†“
BalanceCalculationService.calculate_current_balance(apartment)
  â†“
1. Î Î±Î¯ÏÎ½ÎµÎ¹ ÏŒÎ»Î± Ï„Î± Transaction records (Ï„Î±Î¾Î¹Î½Î¿Î¼Î·Î¼Î­Î½Î± Ï‡ÏÎ¿Î½Î¿Î»Î¿Î³Î¹ÎºÎ¬)
  â†“
2. Running balance = 0
  â†“
3. Î“Î¹Î± ÎºÎ¬Î¸Îµ transaction:
   IF type = payment â†’ balance -= amount (Î¼ÎµÎ¯Ï‰ÏƒÎ· Ï‡ÏÎ­Î¿Ï…Ï‚)
   IF type = charge â†’ balance += amount (Î±ÏÎ¾Î·ÏƒÎ· Ï‡ÏÎ­Î¿Ï…Ï‚)
   IF type = adjustment â†’ balance = balance_after
  â†“
4. Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ Ï„ÎµÎ»Î¹ÎºÏŒ balance
  â†“
5. Î•Î½Î·Î¼ÎµÏÏÎ½ÎµÎ¹ apartment.current_balance (Î±Î½ Ï‡ÏÎµÎ¹Î±ÏƒÏ„ÎµÎ¯)
```

---

### Î¡Î¿Î® ÎœÎµÏ„Î±Ï†Î¿ÏÎ¬Ï‚ Î¥Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½ (Balance Transfer)

```
ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ Î¼Î®Î½Î±
  â†“
MonthlyBalance.close_month()
  â†“
1. Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ net_result = payments - obligations
  â†“
2. Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ carry_forward (Î±ÏÎ½Î·Ï„Î¹ÎºÏŒ = Î¿Ï†ÎµÎ¹Î»Î®)
  â†“
3. Î¥Î²ÏÎ¹Î´Î¹ÎºÏŒ Î£ÏÏƒÏ„Î·Î¼Î±:
   - main_balance_carry_forward (ÎºÎ±Î½Î¿Î½Î¹ÎºÎ­Ï‚ Î´Î±Ï€Î¬Î½ÎµÏ‚ + Ï€Î±Î»Î¹Î­Ï‚ Î¿Ï†ÎµÎ¹Î»Î­Ï‚)
   - reserve_balance_carry_forward (Î±Ï€Î¿Î¸ÎµÎ¼Î±Ï„Î¹ÎºÏŒ)
   - management_balance_carry_forward (Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·)
  â†“
4. is_closed = True
  â†“
5. MonthlyBalance.create_next_month()
   - Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î½Î­Î¿Ï… MonthlyBalance Î³Î¹Î± ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ Î¼Î®Î½Î±
   - previous_obligations = carry_forward
   - Î£Ï…Î½ÎµÏ‡Î®Ï‚ Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¬ (Î”ÎµÎºÎ­Î¼Î²ÏÎ¹Î¿Ï‚ â†’ Î™Î±Î½Î¿Ï…Î¬ÏÎ¹Î¿Ï‚ Ï‡Ï‰ÏÎ¯Ï‚ Î¼Î·Î´ÎµÎ½Î¹ÏƒÎ¼ÏŒ)
```

---

### Î¡Î¿Î® Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·Ï‚ Î‘ÎºÎµÏÎ±Î¹ÏŒÏ„Î·Ï„Î±Ï‚ (Daily/Weekly)

```
Cron Job
  â†“
BalanceMaintenanceService.run_daily_validation()
  â†“
Î“Î¹Î± ÎºÎ¬Î¸Îµ Building:
  â†“
  BalanceIntegrityService.validate_all_balances()
    â†“
    Î“Î¹Î± ÎºÎ¬Î¸Îµ Apartment:
      - validate_apartment_balance()
      - ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚: stored_balance vs calculated_balance
      - Î‘Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ·: duplicate transactions
      - Î‘Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ·: suspicious transactions
    â†“
  Î‘Î½ errors_found > 0:
    â†“
    BalanceIntegrityService.send_integrity_alert()
      â†’ Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® email ÏƒÏ„Î¿Î½ admin
```

---

### Î¡Î¿Î® Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î·Ï‚ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚ Î”Î±Ï€Î±Î½ÏÎ½

```
Management Command: generate_recurring_expenses
  â†“
CommonExpenseAutomationService.generate_monthly_expenses(building_id, month, year)
  â†“
1. Î“Î¹Î± management_fee:
   RecurringExpenseConfig.get_active_config()
   â†“
   calculate_total_amount()
   â†“
   Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Expense (category='management_fees', expense_type='management_fee')
  â†“
2. Î“Î¹Î± reserve_fund:
   RecurringExpenseConfig.get_active_config()
   â†“
   calculate_total_amount()
   â†“
   Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Expense (category='reserve_fund', expense_type='reserve_fund')
  â†“
3. Trigger: ExpenseViewSet.perform_create()
   â†’ Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Ï‡ÏÎ­Ï‰ÏƒÎ· Î´Î¹Î±Î¼ÎµÏÎ¹ÏƒÎ¼Î¬Ï„Ï‰Î½
```

---

## ğŸ“Š Î£Ï‡Î­ÏƒÎ· ÎœÎµÏ„Î±Î¾Ï ÎœÎ¿Î½Ï„Î­Î»Ï‰Î½

```
Building
  â”œâ”€â”€ Supplier (1-to-many)
  â”œâ”€â”€ Expense (1-to-many)
  â”‚   â”œâ”€â”€ supplier (ForeignKey)
  â”‚   â”œâ”€â”€ project (ForeignKey to Project)
  â”‚   â””â”€â”€ triggered: Transaction creation for apartments
  â”œâ”€â”€ Transaction (1-to-many)
  â”œâ”€â”€ MonthlyBalance (1-to-many)
  â””â”€â”€ RecurringExpenseConfig (1-to-many)

Apartment
  â”œâ”€â”€ Payment (1-to-many)
  â”‚   â””â”€â”€ triggered: Transaction creation
  â”œâ”€â”€ Transaction (1-to-many)
  â”œâ”€â”€ MeterReading (1-to-many)
  â””â”€â”€ current_balance (computed from Transactions)

Transaction
  â”œâ”€â”€ apartment (ForeignKey)
  â”œâ”€â”€ building (ForeignKey)
  â”œâ”€â”€ reference_type, reference_id (polymorphic)
  â”‚   â”œâ”€â”€ 'expense' â†’ Expense
  â”‚   â””â”€â”€ 'payment' â†’ Payment
  â””â”€â”€ used by: BalanceCalculationService

MonthlyBalance
  â”œâ”€â”€ building (ForeignKey)
  â””â”€â”€ creates: next MonthlyBalance (continuous transfer)
```

---

## ğŸ”‘ ÎšÎ»ÎµÎ¹Î´Î¹Î¬ ÎšÎ±Ï„Î±Î½ÏŒÎ·ÏƒÎ·Ï‚

### 1. **Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î± (Balances)**
- **Î˜ÎµÏ„Î¹ÎºÏŒ balance** = Î§ÏÎ­Î¿Ï‚ (apartment owes money)
- **Î‘ÏÎ½Î·Ï„Î¹ÎºÏŒ balance** = Î Î¯ÏƒÏ„Ï‰ÏƒÎ· (apartment has credit)
- **Single Source of Truth:** `apartment.current_balance`
- **Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚:** Î‘Ï€ÏŒ `BalanceCalculationService` Î²Î¬ÏƒÎµÎ¹ `Transaction` history

### 2. **ÎšÎ±Ï„Î±Î½Î¿Î¼Î® Î”Î±Ï€Î±Î½ÏÎ½ (Distribution)**
- **by_participation_mills:** (amount Ã— apartment_mills) / total_mills
- **equal_share:** amount / total_apartments
- **by_meters:** (amount Ã— apartment_meters) / total_meters
- **specific_apartments:** Manual selection

### 3. **ÎœÎµÏ„Î±Ï†Î¿ÏÎ¬ Î¥Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½ (Balance Transfer)**
- **Continuous Transfer:** Î”ÎµÎºÎ­Î¼Î²ÏÎ¹Î¿Ï‚ â†’ Î™Î±Î½Î¿Ï…Î¬ÏÎ¹Î¿Ï‚ (Ï‡Ï‰ÏÎ¯Ï‚ Î¼Î·Î´ÎµÎ½Î¹ÏƒÎ¼ÏŒ)
- **Monthly Transfer:** ÎœÎ®Î½Î±Ï‚ Î â†’ ÎœÎ®Î½Î±Ï‚ Î+1
- **Hybrid System:** ÎÎµÏ‡Ï‰ÏÎ¹ÏƒÏ„Î¬ carry_forward Î³Î¹Î±:
  - ÎšÏÏÎ¹Î¿ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ (main)
  - Î‘Ï€Î¿Î¸ÎµÎ¼Î±Ï„Î¹ÎºÏŒ (reserve)
  - Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· (management)

### 4. **Î¤ÏÏ€Î¿Î¹ Î£Ï…Î½Î±Î»Î»Î±Î³ÏÎ½ (Transaction Types)**
- **Payments:** ÎœÎµÎ¹ÏÎ½Î¿Ï…Î½ Ï‡ÏÎ­Î¿Ï‚ (balance -= amount)
- **Charges:** Î‘Ï…Î¾Î¬Î½Î¿Ï…Î½ Ï‡ÏÎ­Î¿Ï‚ (balance += amount)
- **Adjustments:** Î˜Î­Ï„Î¿Ï…Î½ balance Î±Ï€ÎµÏ…Î¸ÎµÎ¯Î±Ï‚ (balance = balance_after)

### 5. **Î•Ï…Î¸ÏÎ½Î· Î Î»Î·ÏÏ‰Î¼Î®Ï‚ (Payer Responsibility)**
- **owner:** Î™Î´Î¹Î¿ÎºÏ„Î®Ï„Î·Ï‚ (Î­ÏÎ³Î±, Î±Ï€Î¿Î¸ÎµÎ¼Î±Ï„Î¹ÎºÏŒ, Î­ÎºÏ„Î±ÎºÏ„ÎµÏ‚ ÎµÏ€Î¹ÏƒÎºÎµÏ…Î­Ï‚)
- **resident:** ÎˆÎ½Î¿Î¹ÎºÎ¿Ï‚ (Ï„Î±ÎºÏ„Î¹ÎºÎ¬ ÎºÎ¿Î¹Î½ÏŒÏ‡ÏÎ·ÏƒÏ„Î±)
- **shared:** ÎšÎ¿Î¹Î½Î® ÎµÏ…Î¸ÏÎ½Î·

---

## ğŸ“ Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚

### ÎšÏÎ¯ÏƒÎ¹Î¼Î± Î£Î·Î¼ÎµÎ¯Î±:
1. **Balance Calculation:** Î Î¬Î½Ï„Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ `BalanceCalculationService` (Single Source of Truth)
2. **Date Filtering:** Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ `date__lt` (ÏŒÏ‡Î¹ `date__lte`) Î³Î¹Î± balance transfers (Î±Ï€Î¿Ï†Ï…Î³Î® Î´Î¹Ï€Î»Î®Ï‚ Ï‡ÏÎ­Ï‰ÏƒÎ·Ï‚)
3. **Transaction Creation:** Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ `Expense` ÎºÎ±Î¹ `Payment` saves
4. **Audit Trail:** ÎŒÎ»ÎµÏ‚ Î¿Î¹ Î¿Î¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÎ­Ï‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ ÎºÎ±Ï„Î±Î³ÏÎ¬Ï†Î¿Î½Ï„Î±Î¹ Î¼Îµ `FinancialAuditLog`
5. **Data Integrity:** Î‘Ï…Ï„ÏŒÎ¼Î±Ï„ÎµÏ‚ ÎµÏ€Î±Î»Î·Î¸ÎµÏÏƒÎµÎ¹Ï‚ Î¼Îµ `BalanceIntegrityService` (daily/weekly)

### Î’Î­Î»Ï„Î¹ÏƒÏ„ÎµÏ‚ Î ÏÎ±ÎºÏ„Î¹ÎºÎ­Ï‚:
- Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎ· `BalanceCalculationService` Î³Î¹Î± ÏŒÎ»Î¿Ï…Ï‚ Ï„Î¿Ï…Ï‚ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿ÏÏ‚
- Validation Î¼Îµ `BalanceIntegrityService` Ï€ÏÎ¹Î½ Î±Ï€ÏŒ production changes
- Audit logging Î³Î¹Î± ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î¿Î¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÎ­Ï‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚
- Continuous balance transfers (ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Î¼ÎµÏ„Î±Î¾Ï ÎµÏ„ÏÎ½)
- ÎÎµÏ‡Ï‰ÏÎ¹ÏƒÏ„Î¬ carry_forward Î³Î¹Î± Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ¿ÏÏ‚ Ï„ÏÏ€Î¿Ï…Ï‚ Î¿Ï†ÎµÎ¹Î»ÏÎ½

---

**Î¤ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ·:** 2025-10-09
**Î’Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ÏƒÏ„Î¿Î½ ÎºÏÎ´Î¹ÎºÎ± Î±Ï€ÏŒ:** `/home/theo/project/linux_version/backend/financial/`
