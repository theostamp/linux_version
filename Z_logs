# Logs

## 2025-11-22: Διόρθωση Kiosk Display - Building Reset Issue

### Πρόβλημα
Στο `/kiosk-display` με URL parameter `?building=2&building_id=2`, η εμφάνιση "έπεφτε" στο κτίριο 1 μετά από 1-2 δευτερόλεπτα, ενώ το URL παρέμενε αμετάβλητο.

### Αιτία
Το `BuildingContext` εκτελούσε `loadBuildings()` και:
1. Διάβαζε το `selectedBuildingId` από localStorage
2. Αν δεν το έβρισκε στη λίστα, επέλεγε το **πρώτο κτίριο** (default behavior)
3. Ενημέρωνε το `selectedBuilding` → triggering useEffect στο kiosk-display
4. Το `effectiveBuildingId` αλλάζει σε 1

### Λύση
**Αρχείο**: `/home/theo/project/public-app/src/app/kiosk-display/page.tsx`

#### Αλλαγές:
1. **Προσθήκη refs για state tracking**:
   - `hasUrlParam`: Παρακολουθεί αν υπάρχει URL parameter
   - `lastSetBuildingId`: Αποτρέπει infinite loops

2. **Διαχωρισμός λογικής σε 2 effects**:
   - **Effect 1** (γραμμές 44-69): Χειρίζεται URL parameter - **υψηλότερη προτεραιότητα**
     - Τρέχει μόνο όταν αλλάζει το `buildingParam`
     - Ενημερώνει το context ΜΟΝΟ αν το building ID είναι διαφορετικό από το τελευταίο που έθεσε
   - **Effect 2** (γραμμές 71-76): Fallback στο context
     - Τρέχει ΜΟΝΟ όταν ΔΕΝ υπάρχει URL parameter

3. **Αποτέλεσμα**:
   - Το URL parameter έχει πλέον **απόλυτη προτεραιότητα**
   - Το `BuildingContext` δεν μπορεί πλέον να override το building selection
   - Αποτρέπεται το reset στο building 1

### Τεχνική Λεπτομέρεια
Η χρήση του `lastSetBuildingId.current` ref αποτρέπει το effect από το να τρέχει ξανά όταν το `BuildingContext` προσπαθεί να αλλάξει το `selectedBuilding`, εφόσον το `buildingParam` (από το URL) παραμένει σταθερό.

### Status
✅ **Διορθώθηκε** - Το kiosk-display διατηρεί πλέον το building από το URL parameter χωρίς reset.

